(()=>{var d=class l{static triggerEvent=function(t,e){if(document.createEvent){let n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),n.eventName=e,t.dispatchEvent(n)}else{let n=document.createEventObject();n.eventName=e,n.eventType=e,t.fireEvent(n.eventType,n)}};static getArray=function(t,e,n="/"){let r=l.ltrim(t,n).split(n),i=e;for(let s in r)if(Object.prototype.hasOwnProperty.call(r,s)){if(typeof i>"u"||!Object.prototype.hasOwnProperty.call(i,r[s]))return null;i=i[r[s]]}return i};static trim=function(t,e=" "){return l.ltrim(l.rtrim(t,e),e)};static rtrim=function(t,e=" "){return t.replace(new RegExp("["+e+"]*$"),"")};static ltrim=function(t,e=" "){return t.replace(new RegExp("^["+e+"]*"),"")};static htmlspecialchars=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"]];static htmlspecialchars_encode=function(t){let e=t,n=htmlspecialchars.length;for(let r=0;r<n;++r)e=e.replace(new RegExp(l.htmlspecialchars[r][0],"g"),l.htmlspecialchars[r][1]);return e};static htmlspecialchars_decode=function(t){let e=t,n=l.htmlspecialchars.length;for(let r=0;r<n;++r)e=e.replace(new RegExp(l.htmlspecialchars[r][1],"g"),l.htmlspecialchars[r][0]);return e};static substr_count=function(t,e){if(t+="",e+="",e.length<=0)return t.length+1;let n=0,r=0,i=e.length;for(;r=t.indexOf(e,r),r>=0;)++n,r+=i;return n};static hasClass=function(t,e){return typeof t<"u"&&t!==null&&(typeof t.className=="string"&&t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))!==null||typeof t.className.baseVal=="string"&&t.className.baseVal.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))!==null)};static addClass=function(t,e){l.hasClass(t,e)||(typeof t.className=="string"?t.className+=t.className!==""?" "+e:e:typeof t.className.baseVal=="string"&&(t.className.baseVal+=t.className.baseVal!==""?" "+e:e))};static removeClass=function(t,e){if(l.hasClass(t,e)){let n=new RegExp("(\\s|^)"+e);typeof t.className=="string"?t.className=t.className.replace(n,"").trim():typeof t.className.baseVal=="string"&&(t.className.baseVal=t.className.baseVal.replace(n,"").trim())}};static watcher=function(){let t=0;return function(e,n){clearTimeout(t),t=setTimeout(e,n)}}();static preventAll=function(t){return t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),t.cancelBubble=!0,!1};static ready=function(t){document.readyState==="complete"||document.readyState==="loaded"||document.readyState==="interactive"?t():document.addEventListener("DOMContentLoaded",function(e){t()})};static getValue=function(t){switch(t.tagName.toLowerCase()){case"div":case"pre":case"article":case"section":return t.innerHTML;default:return t.value}};static empty=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)};static hash=function(t){let e=0,n=t.length;for(let r=0;r<n;++r)e=e*31+t.charCodeAt(r);return e};static isNode=function(t){return typeof Node=="object"?t instanceof Node:t&&typeof t=="object"&&typeof t.nodeType=="number"&&typeof t.nodeName=="string"};static isElement=function(t){return typeof HTMLElement=="object"?t instanceof HTMLElement:t&&typeof t=="object"&&t!==null&&t.nodeType===1&&typeof t.nodeName=="string"};static getByClass=function(t,e){let n=t.childNodes.length;for(let r=0;r<n;++r)if(l.hasClass(t.childNodes[r],e))return t.childNodes[r];return null};static addEventListenerToAll=function(t,e,n){let r=t.length;for(let i=0;i<r;++i)t[i].addEventListener(e,n)};static isValidJson=function(t){try{JSON.parse(t)}catch{return!1}return!0};static merge=function(t,e){let n=l.clone(t);for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&typeof e[r]=="object"?n[r]=l.merge(n[r],e[r]):n[r]=e[r];return n};static clone=function(t){return{...t}};static isset=function(t){return typeof t<"u"&&t!==null};static strpbrk=function(t,e){let n=e.length,r=t.length,i=t.length;for(let s=0;s<n;++s)(r=t.indexOf(e.charAt(s)))>=0&&i>r&&(i=r);return t.slice(i)}};var J=class{constructor(){this.assets={},this.registerLoadedAssets()}registerLoadedAssets(){let t=document.getElementsByTagName("script"),e=t?t.length:0;this.assets={};for(let n=0;n<e;++n)this.assets[d.hash(t[n].src)]=t[n].src}load(t,e,n){let r;if(!this.assets[r=d.hash(t)]){let i=null;if(e==="js"){if(i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",t),typeof i<"u"){let s=document.getElementsByTagName("head");s&&s[0].appendChild(i)}this.assets[r]=t}else if(e==="css"){if(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t),typeof i<"u"){let s=document.getElementsByTagName("head");s&&s[0].appendChild(i)}this.assets[r]=t}else e==="img"&&(this.assets[r]=new Image,this.assets[r].src=t);return n&&(i.onreadystatechange=function(){this.readyState==="complete"&&n()},i.onload=n()),r}return!1}get(t){return t=d.hash(t),this.assets[t]?this.assets[t]:null}remove(t){return t=d.hash(t),typeof this.assets[t]<"u"?(delete this.assets[t],!0):!1}};var R=Object.freeze({EMERGENCY:"emergency",ALERT:"alert",CRITICAL:"critical",ERROR:"error",WARNING:"warning",NOTICE:"notice",INFO:"info",DEBUG:"debug"});var q=class l{constructor(t){this.uri="",this.scheme="",this.host="",this.port="",this.user="",this.pass="",this.query=null,this.queryString="",this.fragment="",this.base="",this.root="/",this.set(t)}static parseUrl(t,e="php"){let n=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};if(!Object.prototype.hasOwnProperty.call(r,e))throw new Error("Unexpected parsing mode.","UriFactory",52);let i=r[e].exec(t),s={},o=14;for(;--o;)i[o]&&(s[n[o]]=i[o]);return delete s.source,s}static getUriQueryParameter(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let r=new RegExp("[\\?&]*"+e+"=([^&#]*)").exec(t);return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}static getAllUriQueryParameters(t){let e={},n=[],r=null;if(t.length){n=t.split("&");for(r in n){if(!Object.prototype.hasOwnProperty.call(n,r))continue;let i=n[r].split("=")[0];i.length&&(typeof e[i]>"u"&&(e[i]=[]),e[i].push(n[r].split("=")[1]))}}return e}set(t){this.uri=t;let e=l.parseUrl(this.uri,"php");this.scheme=e.scheme,this.host=e.host,this.port=e.port,this.user=e.user,this.pass=e.pass,this.path=e.path,this.path.endsWith(".php")&&(this.path=this.path.substr(0,-4)),this.queryString=typeof e.query<"u"?e.query:[],this.queryString!==null&&(this.query=l.getAllUriQueryParameters(this.queryString)),this.fragment=typeof e.fragment<"u"?e.fragment:"",this.base=this.scheme+"://"+this.host+this.root}setRootPath(t){this.root=t,this.set(this.uri)}getRootPath(){return this.root}getBase(){return this.base}getScheme(){return this.scheme}getHost(){return this.host}getPort(){return this.port}getUser(){return this.user}getPass(){return this.pass}getQuery(){return this.queryString}getUri(){return this.uri}getFragment(){return this.fragment}getPath(){return this.path}getPathOffset(){return d.substr_count(this.root,"/")-1}};var B=class{constructor(t){this.responses=t}get(t=null){return t===null?this.responses:typeof this.responses[t]>"u"?null:this.responses[t]}count(){return this.responses.length}};var k=Object.freeze({POST:"POST",GET:"GET",PUT:"PUT",DELETE:"DELETE",HEAD:"HEAD"});var z=Object.freeze({TEXT:"text",JSON:"json",DOCUMENT:"document",BLOB:"blob",ARRAYBUFFER:"arraybuffer",DEFAULT:""});var K=class{constructor(){this.visObs=null}static unbind(t){this.app.inputManager.getKeyboardManager().unbind(t)}static bindElement(t=null){if(t===null)throw new Error("Input element required");let e=t.type,n=t.parentNode.querySelector(".close");n!==null&&e!=="submit"&&e!=="button"&&n.addEventListener("click",function(){t.value="",t.focus()})}static addRemoteDatalistOptions(t,e){this.clearDatalistOptions(e);let n=new O;n.setData(t.value),n.setType(z.JSON),n.setUri(e.getAttribute("data-list-src")),n.setMethod(k.POST),n.setRequestHeader("Content-Type","application/json"),n.setSuccess(function(r){try{let i=JSON.parse(r.response),s=new B(i),o=s.count(),a=null;for(let c=0;c<o;++c){a=s.getByIndex(c);let u=null,f=a.getData().length;for(let g=0;g<f;++g)u=document.createElement("option"),u.value=a.value,u.text=a.text,e.appendChild(u)}}catch{Logger.instance.error("Invalid JSON object: "+r,"FormManager")}}),n.send()}static clearDatalistOptions(t){let e=t.options.length;for(let n=0;n<e;++n)t.remove(0)}};var D=class l{constructor(t){this.id=t,this.success=null,this.finally=null,this.lastSubmit=0,this.form=null,this.submitInjects=[],this.method="POST",this.action="",this.hasChanges=!1,this.bind()}initializeMembers(){this.submitInjects=[],this.method="POST",this.action=""}getMethod(){return this.method}getAction(){return this.action}getLastSubmit(){return this.lastSubmit}updateLastSubmit(){this.lastSubmit=Math.floor(Date.now())}isOnChange(){let t=this.getFormElement().getAttribute("data-on-change");return t==="true"||t==="1"}getSubmit(t=null){return(t===null?document:t).querySelectorAll("#"+this.id+" input[type=submit], button[form="+this.id+"][type=submit], input[form="+this.id+"][type=submit], #"+this.id+" button[type=submit], .submit[data-form="+this.id+"], #"+this.id+" .submit"+(t!==null?"  .submit":""))}getImagePreviews(){return document.querySelectorAll("#"+this.id+" input[type=file].preview")}getUpdate(t=null){return(t===null?document:t).querySelectorAll("button[form="+this.id+"].update-form, .update-form[data-form="+this.id+"], #"+this.id+' .update-form, [form="'+this.id+'"].update-form'+(t!==null?", .update-form":""))}getSave(t=null){return(t===null?document:t).querySelectorAll("button[form="+this.id+"].save-form, .save-form[data-form="+this.id+"], #"+this.id+' .save-form, [form="'+this.id+'"].save-form'+(t!==null?", .save-form":""))}getCancel(t=null){return(t===null?document:t).querySelectorAll("#"+this.id+" input[type=reset], button[form="+this.id+"][type=reset], input[form="+this.id+"][type=reset], #"+this.id+" button[type=reset], button[form="+this.id+"].cancel-form, .cancel-form[data-form="+this.id+"], #"+this.id+' .cancel-form, [form="'+this.id+'"].cancel-form'+(t!==null?", .cancel-form":""))}getRemove(t=null){return(t===null?document:t).querySelectorAll("button[form="+this.id+"].remove-form, .remove-form[data-form="+this.id+"], #"+this.id+' .remove-form, [form="'+this.id+'"].remove-form'+(t!==null?", .remove-form":""))}getAdd(t=null){return(t===null?document:t).querySelectorAll("button[form="+this.id+"].add-form, .add-form[data-form="+this.id+"], #"+this.id+' .add-form, [form="'+this.id+'"].add-form'+(t!==null?", .add-form":""))}getSuccess(){return this.success}setSuccess(t){this.success=t}getFinally(){return this.finally}setFinally(t){this.finally=t}injectSubmit(t){this.submitInjects.push(t)}getFormElements(t=null){let e=t===null?this.getFormElement():t;if(!e)return[];let n=e.getElementsByTagName("select"),r=e.getElementsByTagName("textarea"),i=[].slice.call(e.getElementsByTagName("input")),s=e.getElementsByTagName("button"),o=e.getElementsByTagName("canvas"),a=[].slice.call(document.querySelectorAll(":not(#"+this.id+") [form="+this.id+"]")),c=e.querySelectorAll("[data-name]"),u=document.querySelectorAll(":not(#"+this.id+") [data-form="+this.id+"]"),h=i.length,f=a.length,g=u.length;for(let m=0;m<h;++m)(i[m]===void 0||typeof i[m]<"u"&&(i[m].type==="checkbox"||i[m].type==="radio")&&!i[m].checked)&&delete i[m];for(let m=0;m<f;++m){if(a[m]===void 0||typeof a[m]<"u"&&e.contains(a[m])){delete a[m];continue}(a[m]===void 0||typeof a[m]<"u"&&(a[m].type==="checkbox"||a[m].type==="radio")&&!a[m].checked)&&delete a[m]}for(let m=0;m<g;++m)if(u[m]===void 0||typeof u[m]<"u"&&e.contains(u[m])){delete u[m];continue}return Array.prototype.slice.call(i).concat(Array.prototype.slice.call(n),Array.prototype.slice.call(r),Array.prototype.slice.call(s),Array.prototype.slice.call(a),Array.prototype.slice.call(c),Array.prototype.slice.call(u),Array.prototype.slice.call(o)).filter(function(m){return m})}getFirstInputElement(t=null){return(t===null?document:t).querySelector("#"+this.id+" input, #"+this.id+" textarea, #"+this.id+" select, [form="+this.id+"], [data-form="+this.id+"]")}getUniqueFormElements(t){let e={};return t.filter(function(n){return Object.prototype.hasOwnProperty.call(e,n.name)?!1:e[n.name]=!0})}getData(t=null){let e={},n=new FormData,r=this.getFormElements(t),i=r.length,s=null;for(let o=0;o<i;++o){let a=l.getElementId(r[o]);if(a!==null){if(r[o].tagName.toLowerCase()==="canvas")s=r[o].toDataURL("image/png");else if(r[o].tagName.toLowerCase()==="input"&&r[o].type==="file"){let c=r[o].files.length;for(let u=0;u<c;++u)n.append(a+u,r[o].files[u])}else if(r[o].tagName.toLowerCase()==="iframe"){let c=Array.prototype.slice.call(r[o].contentWindow.document.querySelectorAll("[form="+this.id+"]")).concat(Array.prototype.slice.call(r[o].contentWindow.document.querySelectorAll("[data-form="+this.id+"] [data-name]"))).filter(function(h){return h}),u=c.length;for(let h=0;h<u;++h){s=c[h].value;let f=l.getElementId(c[h]);Object.prototype.hasOwnProperty.call(e,f)?(e[f].constructor!==Array&&(e[f]=[e[f]]),e[f].push(s)):e[f]=s}continue}else typeof r[o].value<"u"?s=r[o].value:r[o].getAttribute("data-value")!==null?s=r[o].getAttribute("data-value"):s=r[o].innerHTML;Object.prototype.hasOwnProperty.call(e,a)?(e[a].constructor!==Array&&(e[a]=[e[a]]),e[a].push(s)):e[a]=s}}for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.append(o,e[o]!==null&&e[o].constructor===Array?JSON.stringify(e[o]):e[o]);return n}resetValues(){let t=this.getFormElements(),e=t.length;this.getFormElement().reset();for(let r=0;r<e;++r)l.getElementId(t[r])!==null&&(t[r].tagName.toLowerCase()==="canvas"&&t[r].clearRect(0,0,t[r].width,t[r].height),t[r].getAttribute("data-value")!==null&&t[r].setAttribute("data-value",""),t[r].getAttribute("data-name")!==null&&(t[r].innerHTML=""))}getId(){return this.id}getFormElement(){return this.form===null?this.form=document.getElementById(this.id):this.form}isValid(t=null){let e=t===null?this.getFormElements():t,n=e.length;try{for(let r=0;r<n;++r)if(!(!e[r].required&&e[r].value==="")&&(e[r].required&&e[r].value===""||e[r].required&&e[r].getAttribute("type")==="checkbox"&&!e[r].checked||typeof e[r].pattern<"u"&&e[r].pattern!==""&&!new RegExp(e[r].pattern).test(e[r].value)||typeof e[r].maxlength<"u"&&e[r].maxlength!==""&&e[r].value.length>e[r].maxlength||typeof e[r].minlength<"u"&&e[r].minlength!==""&&e[r].value.length<e[r].minlength||typeof e[r].max<"u"&&e[r].max!==""&&e[r].value>e[r].max||typeof e[r].min<"u"&&e[r].min!==""&&e[r].value<e[r].min))return!1}catch(r){d.Log.Logger.instance.error(r)}return!0}getInvalid(t=null){let e=t===null?this.getFormElements():t,n=e.length,r=[];try{for(let i=0;i<n;++i)(e[i].required&&e[i].value===""||typeof e[i].pattern<"u"&&e[i].pattern!==""&&!new RegExp(e[i].pattern).test(e[i].value)||typeof e[i].maxlength<"u"&&e[i].maxlength!==""&&e[i].value.length>e[i].maxlength||typeof e[i].minlength<"u"&&e[i].minlength!==""&&e[i].value.length<e[i].minlength||typeof e[i].max<"u"&&e[i].max!==""&&e[i].value>e[i].max||typeof e[i].min<"u"&&e[i].min!==""&&e[i].value<e[i].min)&&r.push(e[i])}catch(i){d.Log.Logger.instance.error(i)}return r}static getElementId(t){return t.getAttribute("name")!==null?t.getAttribute("name"):t.getAttribute("data-name")!==null?t.getAttribute("data-name"):t.getAttribute("id")!==null?t.getAttribute("id"):t.getAttribute("type")!==null?t.getAttribute("type"):null}getSubmitInjects(){return this.submitInjects}bind(){if(this.clean(),this.form=this.getFormElement(),this.form===null)return;typeof this.form.attributes.method<"u"?this.method=this.form.attributes.method.value:typeof this.form.attributes["data-method"]<"u"?this.method=this.form.attributes["data-method"].value:this.method="EMPTY",typeof this.form.attributes.action<"u"?this.action=this.form.attributes.action.value:typeof this.form.attributes["data-uri"]<"u"?this.action=this.form.attributes["data-uri"].value:this.action="EMPTY";let t=this.getFormElements(),e=t.length;for(let n=0;n<e;++n)switch(t[n].tagName.toLowerCase()){case"input":K.bindElement(t[n]);break;case"select":break;case"textarea":break;case"button":break;default:}}getElementsToBind(t=null){let n=(t===null?document:t).querySelectorAll("[form="+this.id+"]");return Array.prototype.slice.call(n).concat(Array.prototype.slice.call([this.form])).filter(function(r){return r})}clean(){this.initializeMembers()}};var w=class l{static setQuery(t,e,n=!0){return n||!Object.prototype.hasOwnProperty.call(l.uri,t)?(l.uri[t]=e,!0):!1}static getQuery(t){return Object.prototype.hasOwnProperty.call(l.uri,t)?l.uri[t]:null}static clearAll(){return l.uri={},!0}static clear(t){return Object.prototype.hasOwnProperty.call(l.uri,t)?(delete l.uri[t],!0):!1}static clearLike(t){let e=!1,n=new RegExp(t);for(let r in l.uri)Object.prototype.hasOwnProperty.call(l.uri,r)&&n.test(r)&&(delete l.uri[r],e=!0);return e}static unique(t){let e=q.parseUrl(t),n=[];if(t.includes("?")){let i=typeof e.query>"u"?[]:e.query.replace(/\?/g,"&").split("&"),s={},o=i.length,a=null;if((typeof e.fragment>"u"||e.fragment===null)&&i[o-1].includes("#")){let c=i[o-1].split("#")[1];e.fragment=c[1],i[o-1]=c[0]}for(let c=0;c<o;++c)a=i[c].split("="),s[a[0]]=a.length<2?"":a[1];for(let c in s)Object.prototype.hasOwnProperty.call(s,c)&&s[c]!==""&&s[c]!==null&&typeof s[c]<"u"?n.push(c+"="+(s[c].includes("%")?s[c]:encodeURIComponent(s[c]))):Object.prototype.hasOwnProperty.call(s,c)&&n.push(c)}let r=typeof e.fragment<"u"?e.fragment.split("#"):null;return t=(typeof e.scheme<"u"?e.scheme+"://":"")+(typeof e.username<"u"?e.username+":":"")+(typeof e.password<"u"?e.password+"@":"")+(typeof e.host<"u"?e.host:"")+(typeof e.port<"u"?":"+e.port:"")+(typeof e.path<"u"?e.path:"")+(typeof e.query<"u"?"?"+n.join("&"):"")+(typeof e.fragment<"u"?"#"+r[r.length-1]:""),t}static buildAbsolute(t,e=null){return t.startsWith("/")?l.build(window.location.origin+t,e):t.indexOf("://")===-1?l.build(window.location.origin+"/"+t,e):t}static build(t,e=null){let n=q.parseUrl(window.location.href),r=q.getAllUriQueryParameters(typeof n.query>"u"?{}:n.query);for(let s in r)Object.prototype.hasOwnProperty.call(r,s)&&l.setQuery("?"+s,r[s]);let i=t.replace(new RegExp("{[/#?%@.$!].*?}","g"),function(s){if(s=s.substring(1,s.length-1),e!==null&&Object.prototype.hasOwnProperty.call(e,s))return e[s];if(typeof l.uri[s]<"u")return l.uri[s];if(s.indexOf("!")===0){let o=document.querySelector(s.substring(1));if(!o)return"";if(o.tagName.toLowerCase()!=="form")return o.value;let a="",c=new D(o.id).getData();for(let u of c.entries())a+="&"+u[0]+"="+u[1];return a}else{if(s.indexOf("?")===0)return q.getUriQueryParameter(n.query,s.substring(1));if(s==="#")return n.fragment;if(s.indexOf("#")===0){let o=document.getElementById(s.substring(1));if(o){if(o.tagName.toLowerCase()!=="form")return o.value;let a="",c=new D(o.id).getData();for(let u of c.entries())a+="&"+u[0]+"="+u[1];return a}return""}else return s.indexOf("?")===0?n.query():s.indexOf("/")===0?n.path:s.indexOf(":user")===0?n.user:s.indexOf(":pass")===0?n.pass:s.indexOf("/")===0?"ERROR PATH":s==="%"?window.location.href:s}});return i.indexOf("?")===-1&&(i=i.replace("&","?")),l.unique(i)}static setupUriBuilder(t){l.setQuery("/scheme",t.getScheme()),l.setQuery("/host",t.getHost()),l.setQuery("/base",d.rtrim(t.getBase(),"/"))}};w.uri={};var C=Object.freeze({JSON:"json",RAW:"raw",FILE:"file",URL_ENCODE:"url",FORM_DATA:"formdata"});var O=class{constructor(t=null,e=null,n=null){this.uri=t,this.method=e!==null?e:k.GET,this.requestHeader={},this.result={},this.type=n!==null?n:C.JSON,this.data={},this.requestHeader["Content-Type"]=this.setContentTypeBasedOnType(this.type),this.type===C.FORM_DATA&&delete this.requestHeader["Content-Type"],this.result[0]=function(r){S.getInstance().info('Unhandled response from "'+r.responseURL+'" with response data "'+r.response+'"')},this.xhr=new XMLHttpRequest}setContentTypeBasedOnType(t){switch(t){case C.JSON:return"application/json";case C.URL_ENCODE:return"application/x-www-form-urlencoded";case C.FILE:return"";case C.FORM_DATA:return"multipart/form-data";default:return"*/*"}}setMethod(t){this.method=t}getMethod(){return this.method}setResponseType(t){this.xhr.responseType=t}getResponseType(){return this.responseType}setRequestHeader(t,e){this.requestHeader[t]=e,e==="multipart/form-data"&&delete this.requestHeader[t]}getRequestHeader(){return this.requestHeader}setUri(t){this.uri=t}getUri(){return this.uri}setSuccess(t){this.result[200]=t}setResultCallback(t,e){this.result[t]=e}setData(t){this.data=t}getData(){return this.data}setType(t){this.type=t,this.requestHeader["Content-Type"]=this.setContentTypeBasedOnType(this.type)}getType(){return this.type}queryfy(t){let e=[];for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}send(){if(this.uri==="")return;let t=this;if(this.xhr.readyState!==1){if(this.type===C.FORM_DATA)if(this.method===k.GET){let e=this.uri;for(let n of this.data.entries())e+="&"+n[0]+"="+n[1];this.xhr.open(this.method,w.build(e))}else this.xhr.open(this.method,w.build(this.uri));else console.log(w.build(this.uri)),this.xhr.open(this.method,w.build(this.uri));for(let e in this.requestHeader)Object.prototype.hasOwnProperty.call(this.requestHeader,e)&&this.requestHeader[e]!==""&&this.requestHeader[e]!=="multipart/form-data"&&this.xhr.setRequestHeader(e,this.requestHeader[e])}window.omsApp.logger.log(w.build(this.uri)),window.omsApp.logger.log(this.xhr),this.xhr.onreadystatechange=function(){switch(t.xhr.readyState){case 4:typeof t.result[t.xhr.status]>"u"?t.result[0](t.xhr):t.result[t.xhr.status](t.xhr);break;default:}},this.type===C.JSON?this.xhr.send(JSON.stringify(this.data)):this.type===C.RAW||this.type===C.FILE?this.xhr.send(this.data):this.type===C.URL_ENCODE?this.xhr.send(this.queryfy(this.data)):this.type===C.FORM_DATA&&this.xhr.send(this.data)}};var M=Object.freeze({OPERA:"opera",FIREFOX:"firefox",SAFARI:"safari",IE:"msie",EDGE:"edge",CHROME:"chrome",BLINK:"blink",UNKNOWN:"unknown"});var U=Object.freeze({WINDOWS_10:"windows nt 10.0",WINDOWS_81:"windows nt 6.3",WINDOWS_8:"windows nt 6.2",WINDOWS_7:"windows nt 6.1",WINDOWS_VISTA:"windows nt 6.0",WINDOWS_SERVER:"windows nt 5.2",WINDOWS_XP:"windows nt 5.1",WINDOWS_XP_2:"windows xp",WINDOWS_2000:"windows nt 5.0",WINDOWS_ME:"windows me",WINDOWS_98:"win98",WINDOWS_95:"win95",WINDOWS_311:"win16",MAC_OS_X:"macintosh",MAC_OS_X_2:"mac os x",MAC_OS_9:"mac_powerpc",LINUX:"linux",UBUNTU:"ubuntu",IPHONE:"iphone",IPOD:"ipod",IPAD:"ipad",ANDROID:"android",BLACKBERRY:"blackberry",MOBILE:"webos",UNKNOWN:"UNKNOWN"});var V=class{static getBrowser(){return window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0?M.OPERA:typeof InstallTrigger<"u"?M.FIREFOX:Object.toString.call(window.HTMLElement).indexOf("Constructor")>0?M.SAFARI:document.documentMode?M.IE:window.StyleMedia?M.EDGE:window.chrome&&window.chrome.webstore?M.CHROME:(typeof isChrome<"u"&&isChrome||typeof isOpera<"u"&&isOpera)&&window.CSS?M.BLINK:M.UNKNOWN}static getOS(){for(let t in U)if(Object.prototype.hasOwnProperty.call(U,t)&&navigator.appVersion.toLowerCase().indexOf(U[t])!==-1)return U[t];return U.UNKNOWN}};var S=class l{constructor(t=!0,e=!0,n=!1){this.verbose=t,this.ui=e,this.remote=n}static getInstance(t=!0,e=!0,n=!1){return l.instance||(l.instance=new l(t,e,n)),l.instance}interpolate(t,e){t=typeof t>"u"?l.MSG_FULL:t;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&typeof t=="string"&&(t=t.replace("{"+n+"}",e[n]));return typeof t!="string"?JSON.stringify(t):t}createContext(t,e,n){return e.backtrace=console.trace(),e.datetime=new Date().toISOString(),e.version="1.0.0",e.os=V.getOS(),e.browser=V.getBrowser(),e.path=window.location.href,e.datetime=new Date().toString(),e.level=n,e.message=t,e}write(t,e,n){e=this.createContext(t,e,n),this.verbose&&this.writeVerbose(t,e,n),this.ui&&this.writeUi(t,e),this.remote&&this.writeRemote(e)}writeUi(t,e){Notification.permission!=="granted"&&Notification.permission!=="denied"&&Notification.requestPermission().then(function(r){});let n=new Notification("Logger",{body:this.interpolate(t,e)});setTimeout(n.close.bind(n),4e3)}writeVerbose(t,e,n){let r="000";switch(n){case"info":case"notice":case"log":r="000";break;case"debug":r="289E39";break;case"warning":case"alert":r="FFA600";break;case"error":case"critical":case"emergency":r="CF304A";break;default:}console.log("%c"+this.interpolate(t,e,n),"color: #"+r)}writeRemote(t){let e=new O;e.setData(t),e.setType(jsOMS.Message.Response.Response.ResponseType.JSON),e.setUri("/{/lang}/api/log"),e.setMethod(O.RequestMethod.POST),e.setRequestHeader("Content-Type","application/json"),e.setSuccess(function(n){}),e.send()}emergency(t,e={}){this.write(t,e,R.EMERGENCY)}alert(t,e={}){this.write(t,e,R.ALERT)}critical(t,e={}){this.write(t,e,R.CRITICAL)}error(t,e={}){this.write(t,e,R.ERROR)}warning(t,e={}){this.write(t,e,R.WARNING)}notice(t,e={}){this.write(t,e,R.NOTICE)}info(t,e={}){this.write(t,e,R.INFO)}debug(t,e={}){this.write(t,e,R.DEBUG)}log(t,e,n={}){this.write(e,n,t)}console(t,e={}){this.writeVerbose(t,e,R.INFO)}};S.instance=null;S.MSG_FULL="{datetime}; {level}; {version}; {os}; {browser}; {path}; {message}";var Q=class{};var X=class{};var $=class{constructor(){this.logger=S.getInstance(),this.groups={},this.callbacks={}}addGroup(t,e){typeof this.groups[t]>"u"&&(this.groups[t]={}),this.groups[t][e]=!1}reset(t){for(let e in this.groups[t])Object.prototype.hasOwnProperty.call(this.groups[t],e)&&(this.groups[t][e]=!1)}hasOutstanding(t){if(typeof this.groups[t]>"u")return!1;for(let e in this.groups[t])if(!Object.prototype.hasOwnProperty.call(this.groups[t],e)||!this.groups[t][e])return!0;return!1}triggerSimilar(t,e="",n=null){let r=t.startsWith("/"),i=e.startsWith("/"),s={};for(let a in this.groups){let c=a.startsWith("/");r?a.match(t)&&(s[a]=[]):c&&t.match(a)?s[a]=[]:a===t&&(s[a]=[])}for(let a in s){for(let c in this.groups[a]){let u=c.startsWith("/");i?c.match(e)&&s[a].push(c):u&&e.match(c)?s[a].push(e):c===e&&s[a].push([])}s[a].length===0&&s[a].push(e)}let o=!1;for(let a in s)for(let c in s[a])o=this.trigger(a,c,n)||o;return o}trigger(t,e="",n=null){if(typeof this.callbacks[t]>"u"||Math.abs(Date.now()-this.callbacks[t].lastRun)<300||(typeof this.groups[t]<"u"&&(this.groups[t][e]=!0),this.hasOutstanding(t)))return!1;let r=this.callbacks[t].callbacks.length;this.callbacks[t].lastRun=Date.now();for(let i=0;i<r;++i)this.callbacks[t].callbacks[i](n);return this.callbacks[t].remove?this.detach(t):this.callbacks[t].reset&&this.reset(t),!0}detach(t){return this.detachCallback(t)|this.detachGroup(t)}detachCallback(t){return Object.prototype.hasOwnProperty.call(this.callbacks,t)?(delete this.callbacks[t],!0):!1}detachGroup(t){return Object.prototype.hasOwnProperty.call(this.groups,t)?(delete this.groups[t],!0):!1}attach(t,e,n=!1,r=!1){return Object.prototype.hasOwnProperty.call(this.callbacks,t)||(this.callbacks[t]={remove:n,reset:r,callbacks:[],lastRun:0}),this.callbacks[t].callbacks.push(e),!0}isAttached(t){return Object.prototype.hasOwnProperty.call(this.callbacks,t)}count(){return Object.keys(this.callbacks).length}};var Y=class{constructor(){this.messages={}}add(t,e,n=null){n=typeof n<"u"?n:"any",typeof this.messages[t]>"u"&&(this.messages[t]=[]),this.messages[t][n]=e}run(t,e,n=null){n!==null&&typeof this.messages[t]<"u"&&typeof this.messages[t][n]<"u"?this.messages[t][n](e):typeof this.messages[t]<"u"?this.messages[t].null(e):d.Log.Logger.instance.warning("Undefined type: "+t)}};var Z=class{constructor(){this.accounts=[]}add(t){this.accounts[t.getId()]=t}remove(t){return typeof this.accounts[t]<"u"?(delete this.accounts[t],!0):!1}get(t){return this.accounts[t]?this.accounts[t]:null}};var L=Object.freeze({OK:"ok",INFO:"info",WARNING:"warning",ERROR:"error",HIDDEN:"hidden"});var T=class{constructor(t,e,n,r=!1,i=!1){this.status=t,this.title=e,this.message=n,this.vibrate=r,this.isSticky=i,this.primaryButton=null,this.secondaryButton=null,this.duration=3e3}};var I=Object.freeze({APP_NOTIFICATION:1,BROWSER_NOTIFICATION:2});var W=class l{constructor(t,e,n){this.id=t.id,this.inputComponent=t,this.inputField=this.inputComponent.getElementsByClassName("input")[0],this.dropdownElement=document.getElementById(this.id+"-popup"),this.tagElement=document.getElementById(this.id+"-tags"),this.dataList=this.dropdownElement.getElementsByTagName("table")[0],this.dataListBody=this.dataList.getElementsByTagName("tbody")[0],this.dataTpl=document.getElementById(this.id+"-rowElement"),this.tagTpl=this.tagElement!==null?this.tagElement.getElementsByTagName("template")[0]:null,this.src=this.inputField.getAttribute("data-src");let r=this;this.inputField.addEventListener("focusout",function(i){(i.relatedTarget===null||i.relatedTarget.parentElement===null||i.relatedTarget.parentElement.parentElement===null||!d.hasClass(i.relatedTarget.parentElement.parentElement.parentElement,"popup"))&&d.removeClass(r.dropdownElement,"active")}),this.inputField.addEventListener("keydown",function(i){(i.keyCode===13||i.keyCode===40)&&d.preventAll(i),i.keyCode===40?(r.selectOption(r.dataListBody.firstElementChild),d.preventAll(i)):r.inputTimeDelay({id:r.id,delay:300},r.changeCallback,r,i)}),this.inputField.addEventListener("focusin",function(i){d.addClass(r.dropdownElement,"active")}),this.dropdownElement.addEventListener("keydown",function(i){d.preventAll(i),i.code==="Escape"||i.code==="Delete"||i.code==="Backspace"?(r.inputField.focus(),r.clearDataListSelection(r)):i.code==="ArrowUp"?document.activeElement.previousElementSibling!==null&&(r.clearDataListSelection(r),r.selectOption(document.activeElement.previousElementSibling)):i.code==="ArrowDown"?document.activeElement.nextElementSibling!==null&&(r.clearDataListSelection(r),r.selectOption(document.activeElement.nextElementSibling)):(i.code==="Enter"||i.code==="Tab")&&(r.clearDataListSelection(r),r.addToResultList(r,document.activeElement))}),this.dropdownElement.addEventListener("focusout",function(i){r.clearDataListSelection(r),d.removeClass(r.dropdownElement,"active")}),this.dropdownElement.addEventListener("click",function(i){document.activeElement.tagName.toLowerCase()==="tr"&&(r.clearDataListSelection(r),r.addToResultList(r,document.activeElement),d.removeClass(r.dropdownElement,"active"))}),n.observe(this.tagElement,{childList:!0,attributes:!1,subtree:!1}),e.attach(this.id+"-tags-childList",function(i){let s=i.target.querySelectorAll(".close"),o=s===null?0:s.length;o<1||s[o-1].addEventListener("click",function(a){a.target.parentNode.parentNode!==null&&a.target.parentNode.parentNode.removeChild(a.target.parentNode)})})}remoteCallback(t,e){window.omsApp.logger.log(e),e=JSON.parse(e.response)[0];let n=e.length;if(t.dropdownElement.getAttribute("data-active")==="true"){for(;t.dataListBody.firstChild;)t.dataListBody.removeChild(t.dataListBody.firstChild);for(let r=0;r<n;++r){let i=t.dataTpl.content.cloneNode(!0),s=i.querySelectorAll("[data-tpl-text]"),o=s.length;for(let a=0;a<o;++a)s[a].appendChild(document.createTextNode(d.getArray(s[a].getAttribute("data-tpl-text"),e[r])));s=i.querySelectorAll("[data-tpl-value]"),o=s.length;for(let a=0;a<o;++a)s[a].setAttribute("data-value",d.getArray(s[a].getAttribute("data-tpl-value"),e[r]));i.firstElementChild.setAttribute("data-data",JSON.stringify(e[r])),t.dataListBody.appendChild(i),t.dataListBody.lastElementChild.addEventListener("focusout",function(a){if(a.relatedTarget===null)return;let c=a.relatedTarget.parentNode.firstElementChild;do if(c===a.relatedTarget){d.preventAll(a);return}while((c=c.nextElementSibling)!==null)})}}}changeCallback(t){if(typeof t.src<"u"&&t.src!==""){let e=new O(t.src);e.setSuccess(function(n){t.remoteCallback(t,n)}),e.send()}}selectOption(t){t.focus(),t.setAttribute("style","background: #f00"),d.addClass(t,"active")}clearDataListSelection(t){let e=t.dataListBody.getElementsByTagName("tr"),n=e.length;for(let r=0;r<n;++r)e[r].setAttribute("style",""),d.removeClass(e[r],"active")}addToResultList(t,e){let n=JSON.parse(e.getAttribute("data-data"));if(t.inputField.getAttribute("data-autocomplete")==="true"&&(t.inputField.value=d.getArray(t.inputField.getAttribute("data-value"),n)),t.tagElement!==null&&t.tagElement.getAttribute("data-active")==="true"){let r=t.tagTpl.content.cloneNode(!0),i=r.querySelectorAll("[data-tpl-value]"),s=i.length,o="",a="";for(let f=0;f<s;++f)i[f].setAttribute("data-value",d.getArray(i[f].getAttribute("data-tpl-value"),n)),a=d.getArray(i[f].getAttribute("data-tpl-value"),n),o+=a;if(t.tagElement.querySelectorAll('[data-tpl-uuid="'+o+'"').length!==0)return;r.firstElementChild.setAttribute("data-tpl-uuid",o),i=r.querySelectorAll("[data-tpl-text]"),s=i.length;for(let f=0;f<s;++f)i[f].appendChild(document.createTextNode(d.getArray(i[f].getAttribute("data-tpl-text"),n)));let c=/{\/.*?}/g,u=r.firstElementChild.outerHTML.match(c),h=u===null?0:u.length;for(let f=0;f<h;++f)r.firstElementChild.outerHTML=r.firstElementChild.outerHTML.replace(u[f],d.getArray(u[f].substring(1,u[f].length-1),n));t.tagElement.childElementCount>=t.tagElement.getAttribute("data-limit")&&t.tagElement.getAttribute("data-limit")!=="0"&&t.tagElement.removeChild(t.tagElement.firstElementChild),t.tagElement.appendChild(r)}t.inputField.getAttribute("data-emptyAfter")==="true"&&(t.inputField.value=""),t.inputField.focus()}inputTimeDelay(t,e,n,r){l.timerDelay[t.id]&&(clearTimeout(l.timerDelay[t.id]),delete l.timerDelay[t.id]),l.timerDelay[t.id]=setTimeout(function(){delete l.timerDelay[t.id],e(n,r)},t.delay)}};W.timerDelay={};var x=class{constructor(t){this.visObs=null,this.app=t}bind(t=null){let e=null;t!==null&&(e=document.getElementById(t)),this.bindHref(e),this.bindIframe(e),this.bindLazyLoad(e),this.bindInput(e)}bindHref(t=null){t=t!==null?t.querySelectorAll("[data-href], [href]"):document.querySelectorAll("[data-href], [href]");let e=t.length;for(let n=0;n<e;++n)t[n].getAttribute("data-action")===null&&t[n].addEventListener("click",function(r){if(r.target.parentElement!==this&&r.target.parentElement.getElementsByTagName("input").length>0||r.target.getElementsByTagName("input").length>0){let s=r.target.querySelector("input");if(s!==null){s.click();return}}d.preventAll(r);let i=this.getAttribute("data-href");i=i===null?this.getAttribute("href"):i,this.getAttribute("target")==="_blank"||this.getAttribute("data-target")==="_blank"||r.button===1?window.open(w.build(i),"_blank"):this.getAttribute("data-redirect")!==null?window.location.href=w.build(i.indexOf("://")>0?i:d.rtrim(window.omsApp.request.getRootPath(),"/")+"/"+d.ltrim(i,"/")):i!==null&&(window.location.href=w.build(i.indexOf("://")>0?i:d.rtrim(window.omsApp.request.getRootPath(),"/")+"/"+d.ltrim(i,"/")))})}bindIframe(t=null){t=t!==null?t:document.getElementsByTagName("iframe");let e=t.length;for(let n=0;n<e;++n)t[n].getAttribute("data-src")!==null&&(t[n].src=w.build(t[n].getAttribute("data-src"))),t[n].addEventListener("load",function(){let r=this.parentElement.getElementsByClassName("ispinner");r.length>0&&(r[0].style.display="none")})}bindLazyLoad(t=null){t=t!==null?t.querySelectorAll("[data-lazyload]"):document.querySelectorAll("[data-lazyload]");let e=t.length;!this.visObs&&window.IntersectionObserver&&(this.visObs=new IntersectionObserver(function(n,r){n.forEach(i=>{i.intersectionRatio>0&&(r.unobserve(i.target),i.target.src=i.target.dataset.lazyload,delete i.target.dataset.lazyload)})}));for(let n=0;n<e;++n)this.visObs?this.visObs.observe(t[n]):(t[n].src=t[n].dataset.lazyload,delete t[n].dataset.lazyload)}bindInput(t=null){t=t!==null?[t]:document.getElementsByClassName("advancedInput");let e=t.length;for(let n=0;n<e;++n)new W(t[n],this.app.eventManager,this.app.uiManager.getDOMObserver())}static setValueOfElement(t,e){if(t.hasAttribute("data-value")){t.setAttribute("data-value",e);return}let n=t.tagName.toLowerCase();if(n==="input")t.type==="radio"?(t.checked=!1,t.value===e&&(t.checked=!0)):t.type==="checkbox"?(t.checked=!1,e.split(",").includes(t.value)&&(t.checked=!0)):t.value=e;else if(n==="select"){let r=t.options.length;for(let i=0;i<r;++i)if(t.options[i].value===e){t.options[i].selected=!0;break}}else t.getAttribute("value")!==null?t.value=d.htmlspecialchars_decode(e):t.innerHTML=e}static setTextOfElement(t,e){let n=t.tagName.toLowerCase();if(n==="h1")t.innerHTML=d.htmlspecialchars_encode(e);else if(t.getAttribute("value")!==null)t.value===""&&(t.value=d.htmlspecialchars_decode(e));else if(n==="select"){let r=t.options.length;for(let i=0;i<r;++i)if(t.options[i].text===e){t.options[i].selected=!0;break}}else t.innerHTML=e}static getValueFromDataSource(t){if(t.getAttribute("data-value")!==null)return t.getAttribute("data-value");let e=t.tagName.toLowerCase();if(e==="input"||t.getAttribute("value")!==null){if(t.getAttribute("type")==="radio"){let n=document.querySelector('input[type=radio][name="'+t.name+'"]:checked');if(n===null)return"";t=n}else if(t.getAttribute("type")==="checkbox"&&!t.checked)return"";return t.value}else return e==="select"?t.options[t.selectedIndex].value:t.innerText.trim(" ")}static getTextFromDataSource(t){let e=t.tagName.toLowerCase();if(e==="input"){if(t.getAttribute("type")==="radio"){let n=document.querySelector('input[type=radio][name="'+t.name+'"]:checked');return n===null?"":document.querySelector('label[for="'+n.id+'"]').innerText.trim(" ")}else if(t.getAttribute("type")==="checkbox")return t.checked?document.querySelector('label[for="'+t.id+'"]').innerText.trim(" "):"";return t.value}else return e==="select"?t.options[t.selectedIndex].text:t.getAttribute("value")!==null?t.value:t.innerHTML.trim(" ")}};var _=class l{constructor(t){this.app=t,this.forms={},this.ignore={}}get(t){return Object.prototype.hasOwnProperty.call(this.forms,t)||this.bind(t),this.forms[t]}hasChanges(){let t=this.forms.length;for(let e=0;e<t;++e)if(this.forms[e].hasChange())return!0;return!1}isIgnored(t){return this.ignore.indexOf(t)!==-1}bind(t=null){if(t!==null&&typeof this.ignore[t]>"u"){this.bindForm(t);return}let e=document.querySelectorAll("form, [data-tag=form]"),n=e?e.length:0;for(let r=0;r<n;++r){let i=e[r].getAttribute("id");typeof i<"u"&&i!==null&&typeof this.ignore[i]>"u"?this.bindForm(i):S.instance.info("A form doesn't have an ID.")}}bindForm(t=null){if(t===null){S.instance.info("A form doesn't have an ID.");return}this.forms[t]=new D(t);let e=this,n=0,r=this.forms[t].getElementsToBind(),i=r.length;for(let o=0;o<i;++o)r[o].addEventListener("click",function(a){e.formActions(e,a,t)}),this.forms[t].isOnChange()||r[o].addEventListener("change",function(a){window.omsApp.state&&(window.omsApp.state.hasChanges=!0)});let s=this.forms[t].getImagePreviews();n=s===null?0:s.length;for(let o=0;o<n;++o)this.bindImagePreview(s[o],t);if(this.forms[t].isOnChange()){let o=this.forms[t].getFormElement().getAttribute("data-ui-container");(o!==null?this.forms[t].getFormElement().querySelector(o):this.forms[t].getFormElement()).addEventListener("change",function(c){d.preventAll(c),window.omsApp.state&&(window.omsApp.state.hasChanges=!0);let u=c.target.tagName.toLowerCase();if(u==="input"||u==="textarea"){let h=null;e.forms[t].getFormElement().tagName.toLowerCase()==="table"&&(h=c.srcElement.closest(e.forms[t].getFormElement().getAttribute("data-ui-element"))),e.submit(e.forms[t],null,h,"post")}})}}formActionRemove(t,e,n,r){d.preventAll(e);let i=t.forms[n].getRemove()[r],s=function(a){if(a.status!==200){t.app.notifyManager.send(new T(L.ERROR,"Failure","Some failure happened"),I.APP_NOTIFICATION);return}let c=i.closest(document.getElementById(n).getAttribute("data-ui-element"));window.omsApp.logger.log(document.getElementById(n).getAttribute("data-ui-element")),c.parentNode.removeChild(c)},o=document.getElementById(n).getAttribute("action")!==null||document.getElementById(n).getAttribute("data-action")!==null?t.forms[n].getFormElement():document.getElementById(n).getAttribute("data-update-form")!==null?t.forms[document.getElementById(n).getAttribute("data-update-form")].getFormElement():document.getElementById(n).getAttribute("data-delete-form")!==null?t.forms[document.getElementById(n).getAttribute("data-delete-form")].getFormElement():null;if(o!==null){let a=new O(o.hasAttribute("data-action-delete")?o.getAttribute("data-action-delete"):o.tagName.toLowerCase()!=="form"?o.getAttribute("data-action"):o.getAttribute("action"),k.DELETE);a.setResultCallback(0,s),a.send()}else s()}formActionAdd(t,e,n,r){d.preventAll(e),t.forms[n].isValid()&&(document.getElementById(n).getAttribute("data-add-form")===null?this.formActionAddInline(t,e,n,r):this.formActionAddExternal(t,e,n,r))}formActionAddInline(t,e,n,r){let i=t.forms[n].getFormElement(),s=i.getAttribute("data-ui-container"),o=s.charAt(0)==="#"?document.querySelector(s):i.querySelector(s);if(i.getAttribute("data-update-tpl")){let a=o.querySelector(i.getAttribute("data-update-tpl")).content.cloneNode(!0);o.appendChild(a.firstElementChild)}else{let a=o.querySelector(i.getAttribute("data-add-tpl")).content.cloneNode(!0);o.appendChild(a.firstElementChild)}}formActionAddExternal(t,e,n,r){let i=t.forms[n].getFormElement(),s=i.getAttribute("data-ui-container"),o=s.charAt(0)==="#"?document.querySelector(s):i.querySelector(s),a=i.getAttribute("data-add-tpl").split(","),c=a.length,u=[],h=[],f=[];for(let m=0;m<c;++m){f.push(document.querySelector(a[m]).content.cloneNode(!0));let b=f[m].querySelector("[data-tpl-value]").getAttribute("data-tpl-value"),p=b.startsWith("http")||b.startsWith("{")?f[m].firstElementChild:i;u=u.concat(p.hasAttribute("data-tpl-value")?p:Array.prototype.slice.call(p.querySelectorAll("[data-tpl-value]"))),h=h.concat(p.hasAttribute("data-tpl-text")?p:Array.prototype.slice.call(p.querySelectorAll("[data-tpl-text]"))),l.setRandomIdForElement(f[m].firstElementChild)}let g={};t.forms[n].setSuccess(function(m,b){if(b.status===200){l.setDataInElement("value",f,u,g),l.setDataInElement("text",f,h,g);for(let p=0;p<c;++p)o.appendChild(f[p].firstElementChild);window.omsApp.logger.log(g),w.setQuery("$id",m.get("response").id),l.setDataFromRemoteUrls(g),t.forms[n].resetValues()}}),t.submit(t.forms[n],t.forms[n].getAdd()[r])}formActionSave(t,e,n,r){d.preventAll(e),document.querySelector('[data-update-form="'+n+'"')===null?this.formActionSaveInline(t,e,n,r):this.formActionSaveExternal(t,e,n,r)}formActionSaveInline(t,e,n,r){if(!t.forms[n].isValid())return;let i=t.forms[n].getFormElement(),s=i.getAttribute("data-ui-container"),o=s.charAt(0)==="#"?document.querySelector(s):i.querySelector(s),a=i.getAttribute("data-ui-element").split(","),c=a.length,u=[],h=e.target.closest(i.getAttribute("data-ui-element")),f=[],g=[];if(h.getAttribute("data-id")===null||h.getAttribute("data-id")===""){let m=i.getAttribute("data-add-tpl").split(","),b=m.length,p=[];for(let y=0;y<b;++y){p.push(document.querySelector(m[y]).content.cloneNode(!0));let A=p[y].querySelector("[data-tpl-value]").getAttribute("data-tpl-value"),v=A.startsWith("http")||A.startsWith("{")?p[y].firstElementChild:h;f=f.concat(v.hasAttribute("data-tpl-value")?v:Array.prototype.slice.call(v.querySelectorAll("[data-tpl-value]"))),g=g.concat(v.hasAttribute("data-tpl-text")?v:Array.prototype.slice.call(v.querySelectorAll("[data-tpl-text]"))),l.setRandomIdForElement(p[y].firstElementChild)}let E={};t.forms[n].setSuccess(function(y,A){if(A.status===200){l.setDataInElement("value",p,f,E),l.setDataInElement("text",p,g,E);for(let v=0;v<b;++v)o.appendChild(p[v].firstElementChild);h.parentNode.removeChild(h),window.omsApp.logger.log(E),w.setQuery("$id",y.get("response").id),l.setDataFromRemoteUrls(E)}})}else{for(let p=0;p<c;++p){a[p]=a[p].trim(),u.push(i.querySelector(a[p]+'[data-id="'+h.getAttribute("data-id")+'"]'));let E=u[p].querySelector("[data-tpl-value]").getAttribute("data-tpl-value"),y=E.startsWith("http")||E.startsWith("{")?u[p].firstElementChild:h;f=f.concat(y.hasAttribute("data-tpl-value")?y:Array.prototype.slice.call(y.querySelectorAll("[data-tpl-value]"))),g=g.concat(y.hasAttribute("data-tpl-text")?y:Array.prototype.slice.call(y.querySelectorAll("[data-tpl-text]")))}let m=o.querySelector('.hidden[data-id="'+h.getAttribute("data-id")+'"]'),b={};d.removeClass(m,"hidden"),t.forms[n].setSuccess(function(p,E){E.status===200&&(l.setDataInElement("value",[m],f,b),l.setDataInElement("text",[m],g,b),h.parentNode.removeChild(h),l.setDataFromRemoteUrls(b))})}}formActionSaveExternal(t,e,n,r){let i=document.querySelector('[data-update-form="'+n+'"'),s=n;if(n=i.getAttribute("id"),!t.forms[n].isValid())return;let o=t.forms[n].getFormElement(),a=t.forms[s].getFormElement(),c=o.getAttribute("data-ui-element").split(","),u=c.length,h=[],f=[],g=[];for(let A=0;A<u;++A){c[A]=c[A].trim(),h.push(o.querySelector(c[A]+'[data-id="'+a.getAttribute("data-id")+'"]'));let v=h[A].querySelector("[data-tpl-value]").getAttribute("data-tpl-value"),N=v.startsWith("http")||v.startsWith("{")?h[A].firstElementChild:a;f=f.concat(N.hasAttribute("data-tpl-value")?N:Array.prototype.slice.call(N.querySelectorAll("[data-tpl-value]"))),g=g.concat(N.hasAttribute("data-tpl-text")?N:Array.prototype.slice.call(N.querySelectorAll("[data-tpl-text]")))}let m={};for(let A=0;A<u;++A)d.removeClass(h[A],"animated"),d.removeClass(h[A],"greenCricleFade"),requestAnimationFrame(v=>{requestAnimationFrame(N=>{d.addClass(h[A],"animated"),d.addClass(h[A],"medium-duration"),d.addClass(h[A],"greenCricleFade")})});t.forms[s].setSuccess(function(A,v){if(v.status!==200){t.forms[s].resetValues();return}l.setDataInElement("value",h,f,m),l.setDataInElement("text",h,g,m),l.setDataFromRemoteUrls(m);for(let N=0;N<u;++N)d.removeClass(h[N],"animated"),d.removeClass(h[N],"greenCircleFade"),d.removeClass(h[N],"medium-duration"),requestAnimationFrame(Bt=>{requestAnimationFrame(Dt=>{d.addClass(h[N],"animated medium-duration greenCircleFade")})});t.forms[s].resetValues()}),a.setAttribute("data-id",""),t.submit(t.forms[s],t.forms[s].getSave()[r]);let b=t.forms[s].getAdd(),p=b.length;for(let A=0;A<p;++A)d.removeClass(b[A],"hidden");let E=t.forms[s].getSave();p=E.length;for(let A=0;A<p;++A)d.addClass(E[A],"hidden");let y=t.forms[s].getCancel();p=y.length;for(let A=0;A<p;++A)d.addClass(y[A],"hidden")}formActionCancel(t,e,n,r){let i=document.getElementById(n);i.getAttribute("data-update-form")===null&&i.tagName.toLowerCase()!=="form"?this.formActionCancelInline(t,e,n,r):this.formActionCancelExternal(t,e,n,r)}formActionCancelInline(t,e,n,r){let i=t.forms[n].getFormElement(),s=i.getAttribute("data-ui-container"),o=s.charAt(0)==="#"?document.querySelector(s):i.querySelector(s),a=e.target.closest(i.getAttribute("data-ui-element")),c=o.querySelector('.hidden[data-id="'+a.getAttribute("data-id")+'"]');d.removeClass(c,"hidden"),a.parentNode.removeChild(a)}formActionCancelExternal(t,e,n,r){t.forms[n].resetValues(),t.forms[n].getFormElement().setAttribute("data-id","");let i=0,s=t.forms[n].getAdd();i=s.length;for(let c=0;c<i;++c)d.removeClass(s[c],"hidden");let o=t.forms[n].getSave();i=o.length;for(let c=0;c<i;++c)d.addClass(o[c],"hidden");let a=t.forms[n].getCancel();i=a.length;for(let c=0;c<i;++c)d.addClass(a[c],"hidden")}formActionUpdate(t,e,n,r){d.preventAll(e),document.getElementById(n).getAttribute("data-update-form")===null?this.formActionUpdateInline(t,e,n,r):this.formActionUpdateExternal(t,e,n,r)}formActionUpdateInline(t,e,n,r){let i=t.forms[n].getFormElement(),s=i.getAttribute("data-ui-container"),o=e.target.closest(i.getAttribute("data-ui-element"));d.addClass(o,"hidden");let a=o.querySelectorAll("[data-tpl-value]"),c=o.querySelectorAll("[data-tpl-text]"),u=s.charAt(0)==="#"?document.querySelector(s):i.querySelector(s),h=i.getAttribute("data-update-tpl").split(","),f=h.length,g=[];for(let y=0;y<f;++y)g.push(document.querySelector(h[y]).content.cloneNode(!0)),g[y].firstElementChild.setAttribute("data-id",o.getAttribute("data-id"));let m={};l.setDataInElement("value",g,a,m),l.setDataInElement("text",g,c,m);for(let y=0;y<f;++y)u.insertBefore(g[y].firstElementChild,o);let b=t.forms[n].getSave(),p=b.length;for(let y=0;y<p;++y)d.removeClass(b[y],"hidden");let E=t.forms[n].getCancel();p=E.length;for(let y=0;y<p;++y)d.removeClass(E[y],"hidden");t.forms[externalFormId].setSuccess(function(y){y.get("status")!=="undefined"&&y.get("status")!==L.HIDDEN&&t.app.notifyManager.send(new T(y.get("status"),y.get("title"),y.get("message")),I.APP_NOTIFICATION),window.omsApp.logger.log(m),w.setQuery("$id",y.get("response").id),l.setDataFromRemoteUrls(m)})}formActionUpdateExternal(t,e,n,r){let i=t.forms[n].getFormElement(),s=e.target.closest(i.getAttribute("data-ui-element")),o=i.getAttribute("data-update-form"),a=s.querySelectorAll("[data-tpl-value]"),c=s.querySelectorAll("[data-tpl-text]"),u=0;t.forms[o].resetValues(),t.forms[o].getFormElement().setAttribute("data-id",s.getAttribute("data-id"));let h=t.forms[o].getAdd();u=h.length;for(let p=0;p<u;++p)d.addClass(h[p],"hidden");let f=t.forms[o].getSave();u=f.length;for(let p=0;p<u;++p)d.removeClass(f[p],"hidden");let g=t.forms[o].getCancel();u=g.length;for(let p=0;p<u;++p)d.removeClass(g[p],"hidden");let m={};l.insertDataIntoForm(t,"value",o,a,m),u=c.length;let b=a.length;for(let p=0;p<u;++p)if(c[p].tagName.toLowerCase()==="select"){for(let y=0;y<b;++y)if(a[y].getAttribute("name")===c[p].getAttribute("name")){c[p]=null;break}}l.insertDataIntoForm(t,"text",o,c,m),t.forms[o].setSuccess(function(p){p.get("status")!=="undefined"&&p.get("status")!==L.HIDDEN&&t.app.notifyManager.send(new T(p.get("status"),p.get("title"),p.get("message")),I.APP_NOTIFICATION),window.omsApp.logger.log(m),w.setQuery("$id",p.get("response").id),l.setDataFromRemoteUrls(m)})}formActions(t,e,n){let r=0;(r=Array.from(t.forms[n].getRemove()).indexOf(e.target))!==-1?this.formActionRemove(t,e,n,r):(r=Array.from(t.forms[n].getAdd()).indexOf(e.target))!==-1?this.formActionAdd(t,e,n,r):(r=Array.from(t.forms[n].getSave()).indexOf(e.target))!==-1?this.formActionSave(t,e,n,r):(r=Array.from(t.forms[n].getCancel()).indexOf(e.target))!==-1?(d.preventAll(e),this.formActionCancel(t,e,n,r)):(r=Array.from(t.forms[n].getUpdate()).indexOf(e.target))!==-1?this.formActionUpdate(t,e,n,r):((r=Array.from(t.forms[n].getSubmit()).indexOf(e.target))!==-1||(r=Array.from(t.forms[n].getSubmit()).indexOf(e.target.parentNode))!==-1)&&(d.preventAll(e),t.submit(t.forms[n],t.forms[n].getSubmit()[r]))}bindImagePreview(t,e){t.addEventListener("change",function(){let n=document.querySelector("#preview-"+t.getAttribute("name"));n.src=window.URL.createObjectURL(t.files[0]),n.onload=function(){window.URL.revokeObjectURL(this.src)}})}submit(t,e=null,n=null,r=null,i=null){let s=this,o=t.getSubmitInjects(),a=0;e!==null&&(i=e.getAttribute("formaction")),e!==null&&(r=e.getAttribute("formmethod")),this.app.eventManager.isAttached(t.getId())||this.app.eventManager.attach(t.getId(),function(){s.submitForm(t,i,r,n)},!0);for(let u in o)if(Object.prototype.hasOwnProperty.call(o,u)){if(++a,o[u](t,t.getId())===!1)return}else S.instance.warning("Invalid property.");a<1&&this.app.eventManager.trigger(t.getId());let c=t.getFirstInputElement();c!==null&&c.focus()}submitForm(t,e=null,n=null,r=null){let i=t.getData(r);if(!t.isValid(i)){this.app.notifyManager.send(new T(L.INFO,d.lang.Info,d.lang.invalid_form),I.APP_NOTIFICATION),S.instance.debug('Form "'+t.getId()+'" has invalid values.');return}if(t.getMethod()!==k.GET&&Math.abs(Date.now()-t.getLastSubmit())<500)return;t.updateLastSubmit();let s=new O,o=this,a=t.getFormElement().getAttribute("data-redirect");s.setData(i),s.setType(C.FORM_DATA),s.setUri(e!==null?e:t.getAction()),s.setMethod(n!==null?n:t.getMethod()),s.setResultCallback(0,function(c){window.omsApp.logger.log(c.response);let u=c.getResponseHeader("location");if(u!==null&&(window.location=u),c.getResponseHeader("content-type").includes("application/octet-stream")){let h=new Blob([c.response],{type:"application/octet-stream"}),f=document.createElement("a");f.style="display: none",document.body.appendChild(f);let g=window.URL.createObjectURL(h);f.href=g;let m=c.getResponseHeader("content-disposition"),b="";if(m&&m.indexOf("attachment")!==-1){let E=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(m);E!==null&&E[1]&&(b=E[1].replace(/['"]/g,""))}f.download=b,f.click(),window.URL.revokeObjectURL(g),document.body.removeChild(f)}else if(c.getResponseHeader("content-type").includes("text/html"))document.documentElement.innerHTML=c.response,window.omsApp.reInit();else try{let h=JSON.parse(c.response)[0],f=new B(h),g=null,m=parseInt(c.getResponseHeader("status"));(m===200||m===null)&&((g=t.getSuccess())!==null?g(f,c):a!==null&&fetch(w.build(a)).then(b=>b.text()).then(b=>{document.documentElement.innerHTML=b,window.omsApp.state&&(window.omsApp.state.hasChanges=!1),history.pushState({},null,w.build(a)),window.omsApp.reInit()}).catch(b=>{console.warn(b)})),f.get("type")!==null?o.app.responseManager.run(f.get("type"),f.get(),null):typeof h.status<"u"&&h.status!==L.HIDDEN&&o.app.notifyManager.send(new T(h.status,h.title,h.message),I.APP_NOTIFICATION)}catch(h){S.instance.log(h),S.instance.error(`Invalid form response. 
URL: `+t.getAction()+`
Request: `+JSON.stringify(t.getData())+`
Response: `+c.response),o.app.notifyManager.send(new T(L.ERROR,"Failure","Some failure happened"),I.APP_NOTIFICATION)}}),window.omsApp.state&&(window.omsApp.state.hasChanges=!1),s.send(),t.getFinally()!==null&&t.getFinally()()}count(){return this.forms.length}static setDataFromRemoteUrls(t){for(let e in t){let n=new O(e);n.setResultCallback(200,function(r){let i=t[e].length;for(let s=0;s<i;++s){let o=t[e][s].path;t[e][s].type==="value"?x.setValueOfElement(t[e][s].element,o!==null?d.getArray(o,JSON.parse(r.response)):r.response):x.setTextOfElement(t[e][s].element,o!==null?d.getArray(o,JSON.parse(r.response)):r.response)}}),n.send()}}static setRandomIdForElement(t){if(t.getAttribute("data-id")!==null&&t.getAttribute("data-id")!=="")return;let e="";do e="r-"+Math.random().toString(36).substring(7);while(document.querySelector('[data-id="'+e+'"]')!==null);return t.setAttribute("data-id",e),e}static setDataInElement(t,e,n,r={}){let i=[],s=n.length,o=e.length;for(let a=0;a<s;++a){let c=n[a].hasAttribute("data-tpl-"+t+"-path")?n[a].getAttribute("data-tpl-"+t+"-path"):null;for(let u=0;u<o;++u){let h=e[u]instanceof DocumentFragment?e[u].firstElementChild:e[u],f=h.hasAttribute("data-tpl-"+t)&&h.getAttribute("data-tpl-"+t)===n[a].getAttribute("data-tpl-"+t)?[h]:h.querySelectorAll("[data-tpl-"+t+'="'+n[a].getAttribute("data-tpl-"+t)+'"'),g=f.length;for(let m=0;m<g;++m)i.includes(f[m])||c!==null&&c!==f[m].getAttribute("data-tpl-"+t+"-path")||(i.push(f[m]),n[a].getAttribute("data-tpl-"+t).startsWith("http")||n[a].getAttribute("data-tpl-"+t).startsWith("{")?l.populateRemoteUrls(f[m],t,n[a],c,r):t==="value"?x.setValueOfElement(f[m],x.getValueFromDataSource(n[a])):t==="text"&&x.setTextOfElement(f[m],x.getTextFromDataSource(n[a])))}}}static insertDataIntoForm(t,e,n,r,i={}){let s=r.length;for(let o=0;o<s;++o){if(r[o]===null)continue;let a=t.forms[n].getFormElement().querySelectorAll("[data-tpl-"+e+'="'+r[o].getAttribute("data-tpl-"+e)+'"'),c=r[o].hasAttribute("data-tpl-"+e+"-path")?r[o].getAttribute("data-tpl-"+e+"-path"):null,u=a.length;for(let h=0;h<u;++h)r[o].getAttribute("data-tpl-"+e).startsWith("http")||r[o].getAttribute("data-tpl-"+e).startsWith("{")?l.populateRemoteUrls(a[h],e,r[o],c,i):e==="value"?x.setValueOfElement(a[h],x.getValueFromDataSource(r[o])):e==="text"&&(r[o].getAttribute("data-tpl-text")!==r[o].getAttribute("data-tpl-value")||r[o].getAttribute("data-value")!==null)&&x.setTextOfElement(a[h],x.getTextFromDataSource(r[o]))}}static populateRemoteUrls(t,e,n,r,i){let s=n.getAttribute("data-tpl-"+e).startsWith("/")?document.getElementsByTagName("base")[0].href:"";i[s+n.getAttribute("data-tpl-"+e)]===void 0&&(i[s+n.getAttribute("data-tpl-"+e)]=[]),i[s+n.getAttribute("data-tpl-"+e)].push({path:r,element:t,type:e})}};var tt=class{constructor(t){this.app=t}bind(t=null){if(t!==null){let r=document.getElementById(t);r&&this.bindElement(r);return}let e=document.getElementsByClassName("tabview"),n=e?e.length:0;for(let r=0;r<n;++r)this.bindElement(e[r])}bindElement(t){let e=t.querySelectorAll(".tab-links li"),n=e.length;for(let r=0;r<n;++r)e[r].addEventListener("click",function(i){let s=this.querySelector("label").getAttribute("for"),o=this.parentNode.getElementsByClassName("active");if(o.length>0){let c=s.split("&"),u=c.indexOf(o[0].getElementsByTagName("label")[0].getAttribute("for"));u>-1&&c.splice(u,1),s=c.join("&"),d.removeClass(o[0],"active")}s=s.split("&").join("&"),d.addClass(this,"active"),d.hasClass(this.closest(".tabview"),"url-rewrite")&&window.history.replaceState(null,"",w.build("{%}#"+(s===""?"":s)))});this.activateTabUri(t)}activateTabUri(t){let e=window.location.href.includes("#")?q.parseUrl(window.location.href).fragment:"";if(e===null||typeof e>"u")return;let n=e.split("&"),r=n.length;if(r>0&&e!=="")for(let i=0;i<r;++i){let s=t.querySelector('label[for="'+n[i]+'"]');typeof s<"u"&&s!==null&&s.click()}t.querySelector(".tab-links").querySelector(".active")===null&&t.querySelector(".tab-links").querySelector("label").click()}};var et=class{constructor(t){this.id=t,this.table=null}bind(){this.table=document.getElementById(this.id)}serialize(){let t=document.getElementById(this.id),e={caption:null,header:[],rows:[]};e.caption=t.getElementsByTagName("caption")[0].innerText;let n=t.querySelectorAll("thead tr td, thead tr th"),r=n.length;for(let o=0;o<r;++o)e.header.push(n[o].innerText);let i=t.querySelectorAll("tbody tr"),s=i.length;for(let o=0;o<s;++o){e.rows[o]=[];let a=i[o].querySelectorAll("td, th"),c=a.length;for(let u=0;u<c;++u)e.rows[o].push(a[u].innerText)}return e}getExport(){return document.querySelectorAll("#"+this.id+" .download")[0]}getSorting(){return document.querySelectorAll("#"+this.id+" thead .sort-asc, #"+this.id+" thead .sort-desc")}getFilter(){return document.querySelectorAll("#"+this.id+" .filter")}getHeader(){return document.querySelector("#"+this.id+" thead")}getCheckboxes(){return document.querySelectorAll("#"+this.id+" thead input[type=checkbox]")}getSortableRows(){return document.querySelectorAll("#"+this.id+" tbody .order-up, #"+this.id+" tbody .order-down")}};var nt=class l{constructor(t){this.app=t,this.tables={},this.ignore={}}bind(t=null){if(t!==null&&typeof this.ignore[t]>"u"){this.bindTable(t);return}let e=document.getElementsByTagName("table"),n=e?e.length:0;for(let r=0;r<n;++r){let i=e[r].getAttribute("id");typeof i<"u"&&i!==null&&typeof this.ignore[i]>"u"&&this.bindTable(i)}}bindTable(t=null){if(t===null){d.Log.Logger.instance.info("A table doesn't have an ID.");return}this.tables[t]=new et(t),this.bindExport(this.tables[t]);let e=this.tables[t].getSorting(),n=e.length;for(let o=0;o<n;++o)this.bindSorting(e[o],t);let r=this.tables[t].getFilter();n=r.length;for(let o=0;o<n;++o)this.bindFiltering(r[o],t);let i=this.tables[t].getCheckboxes();n=i.length;for(let o=0;o<n;++o)this.bindCheckbox(i[o],t);let s=this.tables[t].getHeader();this.bindColumnVisibility(s,t)}bindExport(t){let e=t.getExport();typeof e>"u"||e===null||e.addEventListener("click",function(n){window.omsApp.logger.log(t.serialize())})}bindColumnVisibility(t){let e=this,n=t.querySelectorAll("td"),r=n.length;for(let i=0;i<r;++i){let s=JSON.parse(window.localStorage.getItem("ui-state-"+this.id+"-header-"+i)),o=t.parentElement.getElementsByTagName("tr"),a=o.length;if(s==="1"&&!d.hasClass(n[i],"hidden"))for(let c=0;c<a;++c){let u=o[c].getElementsByTagName("td");u.length<r||d.addClass(u[i],"hidden")}else if((s==="0"||s===null)&&d.hasClass(n[i],"hidden"))for(let c=0;c<a;++c){let u=o[c].getElementsByTagName("td");u.length<r||d.removeClass(u[i],"hidden")}}t.addEventListener("contextmenu",function(i){if(d.preventAll(i),document.getElementById("table-context-menu")!==null)return;let s=document.getElementById("table-context-menu-tpl");if(s===null)return;let o=document.importNode(s.content,!0);s.parentNode.appendChild(o);let a=document.getElementById("table-context-menu"),c=t.querySelectorAll("td"),u=c.length,h=a.getElementsByClassName("context-line")[0].cloneNode(!0);for(let g=0;g<u;++g){if(c[g].firstElementChild.innerText.trim()==="")continue;let m=h.cloneNode(!0),b=m.firstElementChild.getAttribute("get")+g;m.firstElementChild.setAttribute("for",b),m.firstElementChild.firstElementChild.setAttribute("id",b),m.firstElementChild.appendChild(document.createTextNode(c[g].firstElementChild.innerText.trim()));let p=d.hasClass(c[g],"hidden");a.getElementsByTagName("ul")[0].appendChild(m),a.querySelector("ul").lastElementChild.querySelector('input[type="checkbox"]').checked=!p,a.querySelector("ul").lastElementChild.querySelector('input[type="checkbox"]').addEventListener("change",function(){let E=t.parentElement.getElementsByTagName("tr"),y=E.length,A=d.hasClass(c[g],"hidden");A?window.localStorage.setItem("ui-state-"+e.id+"-header-"+g,JSON.stringify("0")):window.localStorage.setItem("ui-state-"+e.id+"-header-"+g,JSON.stringify("1"));for(let v=0;v<y;++v){let N=E[v].getElementsByTagName("td");A?d.removeClass(N[g],"hidden"):d.addClass(N[g],"hidden")}})}a.getElementsByTagName("ul")[0].removeChild(a.getElementsByClassName("context-line")[0]);let f=s.parentElement.getBoundingClientRect();a.style.top=i.clientY-f.top+"px",a.style.left=i.clientX-f.left+"px",document.addEventListener("click",l.hideMenuClickHandler)})}static hideMenuClickHandler(t){let e=document.getElementById("table-context-menu");!e.contains(t.target)&&(e.parentNode.removeChild(e),document.removeEventListener("click",l.hideMenuClickHandler))}bindSorting(t,e){t.addEventListener("click",function(n){if(this.firstElementChild===null||this.firstElementChild.tagName.toLowerCase()==="a")return;let r=document.getElementById(e),i=r.getElementsByTagName("tbody")[0].rows,s=i.length,o=this.closest("td").cellIndex,a=d.hasClass(this,"sort-asc")?1:-1,c,u,h,f,g,m,b=!1,p=!1,E=this.closest("td").getAttribute("data-name");if(r.setAttribute("data-sorting",(a>0?"+":"-")+(E!==null?E:o)),r.getAttribute("data-src")!==null){l.getRemoteData(r);return}do{for(b=!1,c=0;c<s-1;++c){for(p=!1,h=i[c].getElementsByTagName("td")[o],g=h.getAttribute("data-content")!==null?h.getAttribute("data-content").toLowerCase():h.textContent.toLowerCase(),g=isNaN(g)?isNaN(new Date(g))?g:new Date(g):parseFloat(g),u=c+1;u<s;++u)if(f=i[u].getElementsByTagName("td")[o],m=f.getAttribute("data-content")!==null?f.getAttribute("data-content").toLowerCase():f.textContent.toLowerCase(),m=isNaN(m)?isNaN(new Date(m))?m:new Date(m):parseFloat(m),a===1&&g>m){p=!0;break}else if(a===-1&&g<m){p=!0;break}if(p===!0)break}p&&(i[c].parentNode.insertBefore(i[u],i[c]),b=!0)}while(b)})}bindFiltering(t,e){t.addEventListener("click",function(n){})}bindCheckbox(t,e){t.addEventListener("click",function(n){let r=t.closest("td").cellIndex,i=t.closest("table").querySelectorAll("tbody tr"),s=i.length,o=t.checked;for(let a=0;a<s&&!(typeof i[a].cells[r]>"u");++a){let c=i[a].cells[r].querySelector("input[type=checkbox]");c!==null&&(c.checked=o)}})}static getRemoteData(t){let e={limit:t.getAttribute("data-limit"),offset:t.getAttribute("data-offset"),sorting:t.getAttribute("data-sorting"),filter:t.getAttribute("data-filter")},n=new O;n.setData(e),n.setType(z.JSON),n.setUri(t.getAttribute("data-src")),n.setMethod("GET"),n.setRequestHeader("Content-Type","application/json"),n.setSuccess(function(r){l.emptyTable(t.getElementsByTagName("tbody")[0]),l.addToTable(t.getElementsByTagName("tbody")[0],JSON.parse(r.response)[0])}),n.send()}static emptyTable(t){let e=t.getElementsByTagName("tr"),n=e.length;for(let r=0;r<n;++r)e[r].parentNode.removeChild(e[r])}static addToTable(t,e){let n=e.length;console.table(e);for(let r=0;r<n;++r){let i=t.getElementsByTagName("template")[0].content.cloneNode(!0),s=i.querySelectorAll("[data-tpl-text]"),o=s.length;for(let a=0;a<o;++a)s[a].appendChild(document.createTextNode(d.getArray(s[a].getAttribute("data-tpl-text"),e[r])));s=i.querySelectorAll("[data-tpl-value]"),o=s.length;for(let a=0;a<o;++a)s[a].setAttribute("data-value",d.getArray(s[a].getAttribute("data-tpl-value"),e[r]));t.appendChild(i)}}};var rt=class{constructor(t){this.logger=S.getInstance(),this.app=t,this.actions={}}bind(t=null){let e=t==null?document.querySelectorAll("[data-action]"):typeof t.length<"u"?t:[t],n=e.length;for(let r=0;r<n;++r)e[r]!==null&&e[r].hasAttribute("data-action")&&this.bindElement(e[r])}bindElement(t){if(!d.isValidJson(t.getAttribute("data-action"))){this.logger.error("Invalid json string: '"+t.getAttribute("data-action")+"'");return}let e=JSON.parse(t.getAttribute("data-action")),n=e.length,r=this;for(let i=0;i<n;++i){let s=[t],o=!1;Object.prototype.hasOwnProperty.call(e[i],"selector")&&(s=document.querySelectorAll(e[i].selector),o=!0);let a=s.length;for(let u=0;u<a;++u)this.bindListener(s[u].id,e[i]);let c={childList:!1,attributes:!0,subtree:!1};o&&(this.app.eventManager.attach(t.id+"-childList",function(u){let h=u.addedNodes.length;for(let f=0;f<h;++f)r.bindListener(u.addedNodes[f].id,e[i],typeof e[i].autoremove<"u"?e[i].autoremove:!1)}),c.childList=!0,c.subtree=!0),this.app.eventManager.attach(t.id+"-attributes",function(u){}),this.app.uiManager.getDOMObserver().observe(t,c)}}bindListener(t,e,n=!1){let r=this,i=e.action.length;for(let s=1;s<i;++s){if(typeof t>"u"||typeof e.key>"u"){this.logger.error("Invalid element id/key: "+t+"/"+e.key);return}if(this.app.eventManager.isAttached(t+"-"+e.key+"-"+e.action[s-1].key))return;this.app.eventManager.attach(t+"-"+e.key+"-"+e.action[s-1].key,function(o){r.runAction(t,e,e.action[s],o)},n,!0)}document.getElementById(t).addEventListener(e.listener,function(s){e.preventDefault&&d.preventAll(s),r.runAction(this.id,e,e.action[0],s)},!1)}runAction(t,e,n,r){let i=this;if(!Object.prototype.hasOwnProperty.call(this.actions,n.type)){this.logger.warning("Undefined action "+n.type);return}n.data=r,this.actions[n.type](n,function(s){i.app.eventManager.trigger(t+"-"+e.key+"-"+n.key,t,s)},t)}add(t,e){this.actions[t]=e}};var it=class{constructor(t){this.app=t,this.draggable={},this.dragging=null}bind(t=null){if(t!==null)this.bindElement(t);else{let e=document.querySelectorAll(".oms-dragcontainer"),n=e?e.length:0;for(let r=0;r<n;++r)this.bindElement(e[r])}}bindElement(t){let e=this;t&&(t.addEventListener("dragstart",function(n){e.dragging===null&&(e.dragging=n.target,n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/html",n.target.innerHTML))},!1),t.addEventListener("dragenter",function(n){let r=n.target.closest(".oms-dragcontainer "+this.children[this.children.length-1].tagName),i=Array.from(this.children).indexOf(r),s=Array.from(e.dragging.children).indexOf(e.dragging),o=this.querySelector(".oms-drag-placeholder");o!==null&&this.removeChild(o);let a=document.createElement(e.dragging.tagName);if(e.dragging.tagName.toLowerCase()==="tr"){let c=document.createElement("td");c.setAttribute("colspan",42),a.appendChild(c)}a.setAttribute("draggable","true"),d.addClass(a,"oms-drag-placeholder"),s<i?this.insertBefore(a,r.nextSibling):this.insertBefore(a,r)},!1),t.addEventListener("dragover",function(n){n.preventDefault(),n.dataTransfer.dropEffect="move"},!1),t.addEventListener("dragleave",function(n){n.preventDefault()},!1),t.addEventListener("dragend",function(n){n.preventDefault();let r=this.querySelector(".oms-drag-placeholder");r!==null&&(this.insertBefore(e.dragging,r),this.removeChild(r),e.dragging=null)},!1),t.addEventListener("drop",function(n){n.stopPropagation(),n.preventDefault()},!1))}};var st=class{constructor(t){this.app=t}bind(t=null){if(t!==null){this.bindElement(t);return}let e=document.querySelectorAll(".oms-ordercontainer"),n=e?e.length:0;for(let r=0;r<n;++r)this.bindElement(e[r])}bindElement(t){t&&t.addEventListener("click",function(e){if(!d.hasClass(e.target,"order-up")&&!d.hasClass(e.target,"order-down"))return;d.preventAll(e);let n=t.children.length,r=e.target.closest(".oms-ordercontainer "+this.children[n-1].tagName),i=Array.from(t.children).indexOf(r),s=d.hasClass(e.target,"order-up")?1:-1;s===1&&i>0?t.insertBefore(t.children[i],t.children[i-1]):s===-1&&i<n&&t.insertBefore(t.children[i],t.children[i+2])},!1)}};var ot=class l{constructor(t){this.app=t}bind(){let t=document.querySelectorAll(".oms-remotecontainer"),e=t?t.length:0;setInterval(function(){for(let n=0;n<e;++n){let r=t[n].getAttribute("data-remote-uri"),i=t[n],s=new O;s.setData({}),s.setType(C.JSON),s.setUri(r),s.setMethod(k.GET),s.setSuccess(function(o){let a=JSON.parse(o.response),c=a.length,u=null;for(let g=0;g<c;++g){let m=i.querySelectorAll(i.getAttribute("data-ui-element"));if(u=m.length-1<g?null:m[g],u===null||u.getAttribute("data-id")!==a[g].id){let b=i.getAttribute("data-add-tpl").split(","),p=b.length,E=[],y=[],A=[];for(let v=0;v<p;++v){A.push(document.querySelector(b[v]).content.cloneNode(!0));let N=A[v].firstElementChild;E=E.concat(N.hasAttribute("data-tpl-value")?N:Array.prototype.slice.call(N.querySelectorAll("[data-tpl-value]"))),y=y.concat(N.hasAttribute("data-tpl-text")?N:Array.prototype.slice.call(N.querySelectorAll("[data-tpl-text]")))}l.setRemoteData("text",y,a[g]),l.setRemoteData("value",E,a[g]);for(let v=0;v<p;++v)u===null?i.appendChild(A[v].firstElementChild):i.insertBefore(A[v].firstElementChild,u);continue}else if(u!==null&&u.getAttribute("data-id")===a[g].id){let b=[],p=[],E=u;b=b.concat(E.hasAttribute("data-tpl-value")?E:Array.prototype.slice.call(E.querySelectorAll("[data-tpl-value]"))),p=p.concat(E.hasAttribute("data-tpl-text")?E:Array.prototype.slice.call(E.querySelectorAll("[data-tpl-text]"))),l.setRemoteData("text",p,a[g]),l.setRemoteData("value",b,a[g])}}let h=t[n].querySelectorAll(t[n].getAttribute("data-ui-element")),f=h.length;for(let g=c;g<f;++g)i.removeChild(h[g])}),s.send()}},30*1e3)}static setRemoteData(t,e,n={}){let r=e.length;for(let i=0;i<r;++i){let s=e[i].hasAttribute("data-tpl-"+t+"-path")?e[i].getAttribute("data-tpl-"+t+"-path"):null;s!==null&&(t==="value"?x.setValueOfElement(e[i],d.getArray(s,n)):x.setTextOfElement(e[i],d.getArray(s,n)))}}};var at=class{constructor(t){this.app=t}bind(t=null){if(t!==null){this.bindElement(t);return}let e=document.querySelectorAll(".oms-ui-state"),n=e?e.length:0;for(let r=0;r<n;++r)this.bindElement(e[r])}bindElement(t){if(!t)return;let e=JSON.parse(window.localStorage.getItem("ui-state-"+t.id));switch(e=e!==null?e:{},t.tagName.toLowerCase()){case"input":(e==="1"&&!t.checked||e==="0"&&t.checked)&&t.click(),t.addEventListener("change",function(n){this.getAttribute("type")==="checkbox"||this.getAttribute("type")==="radio"?window.localStorage.setItem("ui-state-"+this.id,JSON.stringify(this.checked?"1":"0")):window.localStorage.setItem("ui-state-"+this.id,JSON.stringify(this.value))});break;case"div":t.scrollLeft=e.x,t.scrollTop=e.y,t.scrollTo({top:e.y,left:e.x}),t.addEventListener("scroll",function(){window.localStorage.setItem("ui-state-"+this.id,JSON.stringify({x:this.scrollLeft,y:this.scrollTop}))});break;default:break}}};var lt=class{constructor(t){this.app=t,this.formManager=new _(this.app),this.tabManager=new tt(this.app),this.tableManager=new nt(this.app),this.actionManager=new rt(this.app),this.dragNDrop=new it(this.app),this.order=new st(this.app),this.generalUI=new x(this.app),this.remoteData=new ot(this.app),this.uiStateManager=new at(this.app);let e=this;this.domObserver=new MutationObserver(function(n){let r=n.length;for(let i=0;i<r;++i)e.app.eventManager.trigger(n[i].target.id+"-"+n[i].type,0,n[i])})}bind(t=null){if(t===null){this.formManager.bind(),this.tabManager.bind(),this.tableManager.bind(),this.actionManager.bind(),this.dragNDrop.bind(),this.order.bind(),this.generalUI.bind(),this.remoteData.bind(),this.uiStateManager.bind();return}let e=document.getElementById(t);if(this.generalUI.bind(e),!!e)switch(e.tagName){case"form":this.formManager.bind(t);break;case"table":this.tableManager.bind(t);break;default:this.actionManager.bind(e)}}getFormManager(){return this.formManager}getActionManager(){return this.actionManager}getDragNDrop(){return this.dragNDrop}getOrder(){return this.order}getRemoteData(){return this.remoteData}getUIStatemanager(){return this.uiStateManager}getTabManager(){return this.tabManager}getTableManager(){return this.tabManager}getDOMObserver(){return this.domObserver}getGeneralUI(){return this.generalUI}};var ct=class{constructor(){this.elements={},this.down=[]}add(t,e,n){typeof this.elements[t]>"u"&&(this.elements[t]=[],this.bind(t)),this.elements[t].push({keys:e,callback:n})}bind(t){let e=this,n=t===""?[document]:document.querySelectorAll(t),r=n.length;for(let i=0;i<r;++i)n[i].addEventListener("keydown",function(s){e.down.push(s.keyCode),e.run(t,s)}),n[i].addEventListener("keyup",function(s){let o=e.down.indexOf(s.keyCode);for(;o>-1;)e.down.splice(o,1),o=e.down.indexOf(s.keyCode)})}run(t,e){if(typeof this.elements[t]>"u")throw new Error("Unexpected elmenet!");let n=this.elements[t].concat(this.elements[""]),r=n.length,i=this.down.length;for(let s=0;s<r;++s){let o=n[s].keys.length,a=!0;for(let c=0;c<o;++c)if(this.down.indexOf(n[s].keys[c])===-1){a=!1;break}if(a){for(let c=0;c<i;++c)if(n[s].keys.indexOf(this.down[c])===-1){a=!1;break}}if(a){d.preventAll(e),n[s].callback(e);break}}}};var F=Object.freeze({CONTEXT:0,LONGPRESS:1,CLICK:2});var ut=class{constructor(){this.elements={},this.click={time:0}}add(t,e,n,r,i){typeof this.elements[t]>"u"&&(this.elements[t]=[]),this.bind(t,e),this.elements[t].push({callback:r,type:e,button:n,exact:i})}bind(t,e){let n=this,r=document.getElementById(t);r&&(e===F.CONTEXT?r.addEventListener("contextmenu",function(i){n.run(t,i)},!1):e===F.LONGPRESS?(r.addEventListener("mousedown",function(i){n.click.time=new Date().getTime()},!1),r.addEventListener("mouseup",function(i){new Date().getTime()-n.click.time>650&&n.run(t,i),n.click.time=0},!1)):e===F.CLICK&&r.addEventListener("click",function(i){n.run(t,i)},!1))}run(t,e){if(typeof this.elements[t]>"u")throw new Error("Unexpected elmenet!");let n=this.elements[t],r=n.length;for(let i=0;i<r;++i)(!n[i].exact||e.target.getAttribute("id")===t)&&n[i].button===e.button&&(d.preventAll(e),n[i].callback())}};var H=class{constructor(t,e={},n="en-US"){this.app=t,this.commands=e,this.lang=n,this.recognition=null,this.speechRecognitionList=null,j!==null&&(this.recognition=new j,this.speechRecognitionList=new St)}setup(){if(j===null)return;let t=this;this.recognition.lang=this.lang,this.recognition.interimResults=!1,this.recognition.maxAlternatives=1,this.recognition.continuous=!0,this.recognition.lang=this.lang,typeof this.commands<"u"&&(this.speechRecognitionList.addFromString(this.getCommandsString(),1),this.recognition.grammars=this.speechRecognitionList),this.recognition.onstart=function(){},this.recognition.onresult=function(e){let n=d.trim(e.results[e.resultIndex][0].transcript),r=Object.keys(t.commands);for(let i of r)n.startsWith(i)&&t.commands[i](n.substr(i.length).trim())},this.recognition.onspeechend=function(){},this.recognition.onnomatch=function(e){S.instance.warning("Couldn't recognize speech")},this.recognition.onerror=function(e){S.instance.warning("Error during speech recognition: "+e.error)}}getCommandsString(){return"#JSGF V1.0; grammar phrase; public <phrase> = "+Object.keys(this.commands).join(" | ")+" ;"}setLanguage(t){this.recognition.lang=t}add(t,e){this.commands[t]=e}start(){j!==null&&this.recognition.start()}stop(){j!==null&&this.recognition.stop()}},j=typeof j<"u"?j:typeof webkitSpeechRecognition<"u"?webkitSpeechRecognition:null,St=typeof St<"u"?St:typeof webkitSpeechGrammarList<"u"?webkitSpeechGrammarList:null;var dt=class{constructor(t){this.keyboardManager=new ct,this.mouseManager=new ut,this.voiceManager=new H(t)}getKeyboardManager(){return this.keyboardManager}getMouseManager(){return this.mouseManager}getVoiceManager(){return this.voiceManager}};var mt=class{static getInstance(t,e){return new omsApp.Modules[t](e)}};var ft=class{constructor(t){this.modules={},this.app=t}get(t){return typeof this.modules[t]>"u"&&(this.modules[t]=mt.getInstance(t,this.app)),this.modules[t]}};var ht=class{constructor(t="en-US"){this.pitch=1,this.rate=1,this.lang=t,this.voices=[],this.voice=null,Nt!==null&&(this.voices=window.speechSynthesis.getVoices(),this.voice=this.voices[0])}read(t){let e=new SpeechSynthesisUtterance(t);e.lang=this.lang,e.voice=this.voice,e.pitch=this.pitch,e.rate=this.rate,window.speechSynthesis.speak(e)}setLanguage(t){this.lang=t}setPitch(t){this.pitch=t}setRate(t){this.rate=t}getVoices(){return this.voices}},Nt=typeof Nt<"u"?Nt:typeof webkitSpeechRecognition<"u"?webkitSpeechRecognition:null;var pt=class{constructor(){this.status=0}setStatus(t){this.status=t}send(t){let e=document.getElementById("app-message-tpl");if(e===null)return;switch(t.status){case 0:t.status=L.OK;break}let n=document.importNode(e.content,!0);if(n.querySelector(".log-msg").classList.add("log-msg-status-"+t.status),n.querySelector(".log-msg-content").innerHTML=t.message,n.querySelector(".close").addEventListener("click",function(){this.parentNode.remove()}),t.title&&t.title!==""?n.querySelector(".log-msg-title").innerHTML=t.title:n.querySelector(".log-msg-title").remove(),t.primaryButton){let s=n.querySelector(".primary-button");s&&(s.innerHTML=t.primaryButton.text,s.addEventListener("click",t.primaryButton.callback))}else{let s=n.querySelector(".primary-button");s&&s.remove()}if(t.secondaryButton){let s=n.querySelector(".secondary-button");s&&(s.innerHTML=t.secondaryButton.text,s.addEventListener("click",t.secondaryButton.callback))}else{let s=n.querySelector(".secondary-button");s&&s.remove()}e.parentNode.appendChild(n);let r=document.getElementsByClassName("log-msg"),i=r[r.length-1];window.navigator.vibrate(t.vibrate?200:0),!t.isSticky&&setTimeout(function(){i!==null&&i.parentNode!==null&&i.parentNode.removeChild(i)},t.duration)}};var gt=class{constructor(){this.status=0}setStatus(t){this.status=t}requestPermission(){Notification.permission!=="granted"&&Notification.permission!=="denied"&&Notification.requestPermission().then(function(t){})}send(t){if(Notification.permission==="granted"){let e=new Notification(t.title,{body:t.message,vibrate:[t.vibrate?200:0]});setTimeout(e.close.bind(e),5e3)}}};var yt=class{constructor(){this.appNotifier=new pt,this.browserNotifier=new gt}send(t,e){I.APP_NOTIFICATION===e?this.appNotifier.send(t):this.browserNotifier.send(t)}getAppNotifier(){return this.appNotifier}getBrowserNotifier(){return this.browserNotifier}};function bt(l,t,e){setTimeout(function(){l.src?document.getElementById(l.src).src=w.build(l.uri):window.location=w.build(l.uri)},parseInt(l.delay))}function xt(l,t){"use strict";let e=new O(l.uri,l.method,l.request_type);e.setSuccess(function(n){window.omsApp.logger.log(n.responseText),t(JSON.parse(n.responseText))}),typeof l.data<"u"&&l.data!==null&&e.setData(l.data),e.send()}function At(l,t,e){"use strict";setTimeout(function(){l.src?(console.log(document.getElementById(l.src).hasAttribute("data-src")),console.log(w.build(document.getElementById(l.src).getAttribute("data-src"))),document.getElementById(l.src).src=document.getElementById(l.src).hasAttribute("data-src")?w.build(document.getElementById(l.src).getAttribute("data-src")):document.getElementById(l.src).src):document.location.reload()},parseInt(l.delay)),t()}function Tt(l,t,e){"use strict";window.omsApp.logger.log("prevented"),d.preventAll(l.data),t()}function It(l,t,e){"use strict";let n=l.base==="self"?l.selector===""?[document.getElementById(e)]:document.getElementById(e).querySelectorAll(l.selector):document.querySelectorAll(l.selector);if(n){for(let r of n)r.click();t()}}function Lt(l,t,e){"use strict";let n=l.base==="self"?l.selector===""||typeof l.selector>"u"?[document.getElementById(e)]:document.getElementById(e).querySelectorAll(l.selector):document.querySelectorAll(l.selector),r={};for(let i in n){if(!Object.prototype.hasOwnProperty.call(n,i)||!(n[i]instanceof HTMLElement))continue;let s=typeof n[i].getAttribute("name")<"u"&&n[i].getAttribute("name")!==""&&n[i].getAttribute("name")!==null?n[i].getAttribute("name"):n[i].getAttribute("id");if(n[i].tagName.toLowerCase()==="input"||n[i].tagName.toLowerCase()==="selects"||n[i].tagName.toLowerCase()==="button")r[s]=n[i].getAttribute("value");else if(n[i].tagName.toLowerCase()==="form"){r=window.omsApp.uiManager.getFormManager().get(s).getData();break}else r[s]=n[i].getAttribute("data-id")}t(r)}function qt(l,t,e){"use strict";let n=l.value,r="",i="",s="",o=0,a=0;for(;n.indexOf("http")!==0&&(o=n.indexOf("{",o))!==-1;)a=n.indexOf("}",o),o++,r=n.substring(o,a),i=d.getArray(r,l.data,"/"),s="{"+r+"}",n=n.replace(new RegExp(s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),i);let c=l.base==="self"?l.selector===""?[document.getElementById(e)]:document.getElementById(e).querySelectorAll(l.selector):document.querySelectorAll(l.selector);for(let u in c)!Object.prototype.hasOwnProperty.call(c,u)||!(c[u]instanceof HTMLElement)||(c[u].tagName.toLowerCase()==="div"||c[u].tagName.toLowerCase()==="span"?c[u].innerHTML.includes(n)||(l.overwrite?c[u].innerHTML=n:l.overwrite||(c[u].innerHTML+=n)):c[u].tagName.toLowerCase()==="iframe"?c[u].src=w.build(n):c[u].value!==n&&!c[u].value.includes(", "+n+",")&&!c[u].value.endsWith(", "+n)&&!c[u].value.startsWith(n+",")&&(l.overwrite?c[u].value=n:c[u].value+=(c[u].value!==""?", ":"")+n));t(l.data)}function kt(l,t,e){"use strict";let n=l.base==="self"?l.selector===""?[document.getElementById(e)]:document.getElementById(e).querySelectorAll(l.selector):document.querySelectorAll(l.selector);if(!n)return;let r=window.omsApp.uiManager.getFormManager();for(let i of n)r.submit(r.get(i.id));t()}var Et={redirect:bt,"message.request":xt,"dom.reload":At,"dom.click":It,"form.submit":kt,"event.prevent":Tt,"dom.get":Lt,"dom.set":qt};var G=[{element:"",keys:[17,80],callback:function(l){document.getElementById("iSearchBox").focus()}},{element:"form, input, textarea, select",keys:[17,13],callback:function(l){let t=document.activeElement,e=t.closest("form");if(e!==null&&(e=e.id),e===null&&(e=t.getAttribute("form")),e===null&&(e=t.getAttribute("data-form")),e===null)return;let r=window.omsApp.uiManager.getFormManager().get(e).getSubmit(),i=r.length,s=-1;for(let o=0;o<i;++o)if(!d.hasClass(r[o],"hidden")){if(d.hasClass(r[o],"add-form")||d.hasClass(r[o],"update-form")||d.hasClass(r[o],"save-form")){r[o].click();break}s=o}s!==-1&&r[s].click()}},{element:"label, tr",keys:[13],callback:function(l){document.activeElement.click()}},{element:"",keys:[17,66],callback:function(l){window.history.back()}},{element:"",keys:[17,40],callback:function(l){let t=document.querySelectorAll('button, input, select, textarea, [tabindex]:not([tabindex="-1"])'),e=t.length;for(let n=0;n<e;++n)if(document.activeElement===t[n]){let r=1;do n+r<e?t[n+r].focus():t[0+r-1].focus(),++r;while(r<e&&document.activeElement===t[n]);return}document.dispatchEvent(new KeyboardEvent("keypress",{keyCode:9}))}},{element:"",keys:[17,38],callback:function(l){let t=document.querySelectorAll('button, input, select, textarea, [tabindex]:not([tabindex="-1"])'),e=t.length;for(let n=0;n<e;++n)if(document.activeElement===t[n]){let r=1;do n-r+1>0?t[n-r].focus():t[e-r].focus(),++r;while(r<e&&document.activeElement===t[n]);return}document.dispatchEvent(new KeyboardEvent("keypress",{keyCode:9}))}}];var Ot=Object.freeze({LEFT:0,MIDDLE:1,RIGHT:2});var P=[{element:"nav-side",type:F.CONTEXT,button:Ot.RIGHT,callback:function(){window.omsApp.logger.log("right clicked")},exact:!0},{element:"nav-side",type:F.LONGPRESS,button:Ot.LEFT,callback:function(){window.omsApp.logger.log("left clicked")},exact:!1}];function Rt(l){let t=new T(l.level,l.title,l.msg);t.duration=5e3,window.omsApp.notifyManager.send(t,I.APP_NOTIFICATION)}function Mt(l){if(!document.getElementById(l.form))return;let e=document.getElementsByClassName("i-"+l.form);for(;e.length>0;)e[0].parentNode.removeChild(e[0]);l.errors.forEach(function(n){let r=document.getElementById(n.id);if(!r)return;let i=document.createElement("i"),s=document.createTextNode(n.msg);i.id="i-"+n.id,i.class="i-"+l.form,i.appendChild(s),r.parentNode.insertBefore(i,r.nextSibling)})}var wt={notify:Rt,validation:Mt,redirect:bt,reload:At};var vt={read:"read_text",help:function(){S.instance.debug("There is no help for you.")},"go to":function(l){let t=new O;t.setData({}),t.setType(C.FORM_DATA),t.setUri("api/navigation/goto?app=Backend&search="+l),t.setMethod(k.GET),t.setSuccess(function(e){window.omsApp.logger.log(e.response);try{let n=JSON.parse(e.response)[0],r=new B(n);typeof r.get("type")<"u"?window.omsApp.responseManager.run(r.get("type"),r.get(),t):typeof n.status<"u"&&n.status!==L.HIDDEN&&window.omsApp.notifyManager.send(new T(n.status,n.title,n.message),I.APP_NOTIFICATION)}catch(n){window.omsApp.logger.log(n),S.instance.error(`Invalid form response. 
Request: `+JSON.stringify(l)+`
Response: `+e.response)}}),t.setResultCallback(0,function(e){window.omsApp.notifyManager.send(new T(L.ERROR,"Failure","Some failure happened"),I.APP_NOTIFICATION)}),t.send()}};var Ct=class{constructor(){this.logger=S.getInstance(!0,!1,!1),window.logger=this.logger,this.cacheManager=new Q,this.storageManager=new X,this.eventManager=new $,this.responseManager=new Y,this.assetManager=new J,this.accountManager=new Z,this.uiManager=new lt(this),this.inputManager=new dt(this),this.moduleManager=new ft(this),this.readManager=new ht,this.voiceManager=new H(this),this.notifyManager=new yt,this.request=null,this.state={hasChanges:!1},this.reInit(),this.setupServiceWorker(),this.setResponseMessages(),this.setVoiceActions(),this.setActions(),this.setKeyboardActions(),this.setMouseActions(),this.setPopstate()}reInit(){this.request=new q(window.location.href),this.request.setRootPath(q.parseUrl(typeof document.getElementsByTagName("base")[0]<"u"?document.getElementsByTagName("base")[0].href:"").path),w.setupUriBuilder(this.request),w.setQuery("/lang",window.location.href.substr(this.request.getBase().length).split("/")[0]),this.uiManager.bind()}setPopstate(){window.addEventListener("popstate",function(t,e){window.location.href=window.location.href})}setupServiceWorker(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/Web/Backend/ServiceWorker.js",{scope:this.request.getBase()}).catch(function(t){S.instance.warning("ServiceWorker registration failed.")})}setResponseMessages(){for(let t in wt)wt.hasOwnProperty(t)&&this.responseManager.add(t,wt[t])}setActions(){for(let t in Et)Et.hasOwnProperty(t)&&this.uiManager.getActionManager().add(t,Et[t])}setKeyboardActions(){let t=G.length;for(let e=0;e<t;e++)this.inputManager.getKeyboardManager().add(G[e].element,G[e].keys,G[e].callback)}setMouseActions(){let t=P.length;for(let e=0;e<t;e++)this.inputManager.getMouseManager().add(P[e].element,P[e].type,P[e].button,P[e].callback,P[e].exact)}setVoiceActions(){for(let t in vt)vt.hasOwnProperty(t)&&this.voiceManager.add(t,vt[t]);this.voiceManager.setup(),this.voiceManager.start()}};d.ready(function(){"use strict";window.omsApp=new Ct});})();
/**
 * Standard library
 *
 * This library provides useful functionalities for the DOM and other manipulations.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Asset manager.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Log Level enum.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Http Uri.
 *
 * This class is for creating, modifying and analyzing http uris.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Response manager class.
 *
 * Used for auto handling different responses.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Http request method.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Response type enum.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Form manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Form view.
 *
 * The form view contains a single form and it's data elements. Form actions are no longer handled by
 * the browser but through this view. The view also provides additional functionality for non-default
 * form elements such as canvas etc.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 *
 * @tood Karaka/jsOMS#60
 *  On change listener
 *  Allow to add a on change listener in a form. This should result in automatic submits after changing a form.
 *  Consider the following cases to submit the form:
 *      * on Enter (all except textarea)
 *      * on Change (by using a timer)
 *      * on Leave (all elements)
 *  The listener should be defined in the form definition once and in js be applied to all form elements.
 */
/**
 * Uri factory.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 *
 * @todo Karaka/phpOMS#239
 *  Optional parameters
 *  Sometimes we need to define a list of optional parameters that will be filled if they exist and only if they exist.
 *  E.g. `u=` for unit `filter=` for filtering etc.
 *  Otherwise the url on some pages keeps getting longer and longer because parameters get appended.
 */
/**
 * Request type enum.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Request class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Request data enum.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * System utils class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Logger class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Request manager class.
 *
 * Used for pooling requests.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Account Manager.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Notification data enum.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * App notification message.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Advanced input class.
 *
 * @copyright  Dennis Eichhorn
 * @license    OMS License 2.0
 * @version    1.0.0
 * @since      1.0.0
 */
/**
 * UI manager for handling basic ui elements.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Tab manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Table view.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 *
 * @todo Karaka/jsOMS#50
 *  Add basic table handling (no db and pagination)
 *
 * @todo Karaka/jsOMS#55
 *  Implement filtering and sorting based on backend
 *
 * @todo Karaka/jsOMS#57
 *  Advanced filtering
 *  The current filtering implementation is only column by column connected with &&.
 *  Consider to implement a much more advanced filtering where different combinations are possible such as || &&, different ordering with parenthesis etc.
 *  This can be extremely powerful but will be complex for standard users.
 *  This advanced filtering should probably be a little bit hidden?
 *
 * @todo Karaka/jsOMS#59
 *  Data download
 *  There is a small icon in the top right corner of tables which allows (not yet to be honest) to download the data in the table.
 *  Whether the backend should be queried for this or only the frontend data should be collected (current situation) should depend on if the table has an api endpoint defined.
 */
/**
 * Table manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 *
 * @todo Karaka/jsOMS#50
 *  Add basic table handling (no db and pagination)
 *
 * @todo Karaka/jsOMS#55
 *  Implement filtering and sorting based on backend
 *
 * @todo Karaka/jsOMS#57
 *  Advanced filtering
 *  The current filtering implementation is only column by column connected with &&.
 *  Consider to implement a much more advanced filtering where different combinations are possible such as || &&, different ordering with parenthesis etc.
 *  This can be extremely powerful but will be complex for standard users.
 *  This advanced filtering should probably be a little bit hidden?
 *
 * @todo Karaka/jsOMS#59
 *  Data download
 *  There is a small icon in the top right corner of tables which allows (not yet to be honest) to download the data in the table.
 *  Whether the backend should be queried for this or only the frontend data should be collected (current situation) should depend on if the table has an api endpoint defined.
 *
 * @todo Allow column drag/drop ordering which is also saved in the front end
 *
 * @todo Save column visibility filter and apply that filter on page load
 */
/**
 * Action manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 *
 * @todo Karaka/jsOMS#26
 *  Sync/Async events
 *  Events so far can be created sync and async depending on the implementation.
 *  It would be better to make it sync/async depending on a option flag.
 *
 * @todo Karaka/jsOMS#35
 *  Template actions cannot be overwritten
 *  Templates by nature get added and removed from a page (often in order to reuse existing html to minimize the html load).
 *  The problem with templates is that they need to register in the ActionManager.js.
 *  A listener currently is only registered once per id.
 *  Since templates often keep the same id for some elements this results in a problem because the new template will not register a new listener.
 *  Possible solutions:
 *      1. Force unique ids for templates during setup (pro: fast and easy initial solution, con: action event pollution not solved)
 *      2. Whenever a dom element with action elements is removed, also unregister the listeners (pro: clean solution, con: difficult to implement)
 *  Solution 2 will be implemented.
 *  Maybe this can be performed in the dom removing action events or a dom listener would be required to listen for these dom elements.
 */
/**
 * Drag and drop class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Manual order class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Remote data class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * UI state manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Keyboard manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Event type.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Mouse manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Voice manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * UI manager class.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Module factory.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Module manager.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * App notification.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Browser notification.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Notification manager.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Click type.
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
/**
 * Application entry point
 *
 * @copyright Dennis Eichhorn
 * @license   OMS License 2.0
 * @version   1.0.0
 * @since     1.0.0
 */
